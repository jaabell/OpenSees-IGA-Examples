#  IGA CANTILEVER PLATE. GEOMETRY OBTAINED FROM NGUYEN'S igaCicleBendingStrip2D

# Validado, Lunes 1 de Marzo


import numpy as np
import opensees as ops
from math import *

# Geomgl utilities for visualization and surface manipulation
from geomdl import NURBS, compatibility, operations, knotvector, multi
from surfVisualize import *


def getCtrlPtsAndWeights(surf):
    # Flip control points to [u][v] (they are given by the getters in [v][u])
    noPtsX = surf.ctrlpts_size_u
    noPtsY = surf.ctrlpts_size_v
    weights = surf.weights
    controlPts = surf.ctrlpts2d[:]
    controlPts = compatibility.flip_ctrlpts2d(controlPts)
    controlPts = (np.array(controlPts).reshape(noPtsX * noPtsY, 4)).tolist()
    noCtrPts = len(controlPts)

    # Get separate array of control points in u,v and weights

    for i in range(len(controlPts)):
        pt = controlPts[i][:]
        wt = pt[-1]
        pt[0:3] = np.array(pt[0:3]) / wt
        controlPts[i] = pt[0:3]
        weights[i] = wt

    return controlPts, weights


def generateKnotVector(deg, nPts):

    import numpy as np
    knotVector = np.zeros(nPts + deg + 1)
    nMiddle = len(knotVector) - 2 * (deg + 1)
    step = 1.0 / (nMiddle + 1)

    ini = np.zeros(deg + 1)
    if step == 0.5:
        middle = np.array([step])
    else:
        middle = np.arange(0 + step, 1 - step, step)
        middle = np.linspace(0 + step, 1 - step, nPts +
                             deg + 1 - 2 * (deg + 1))
    fin = ini + 1

    knotVector = np.copy(ini)
    knotVector = np.append(knotVector, middle)
    knotVector = np.append(knotVector, fin)

    return knotVector


mm = 1.0 / 1000.  # m


ops.wipe()
ops.model('basic', '-ndm', 3, '-ndf', 3)


# These are given in v,u , 12x12 mesh
controlPts = np.array([
    [1.016, 0.0, 0.0, 1.0],
    [1.016, 0.0, 0.09525, 1.0],
    [1.016, 0.0, 0.28575, 1.0],
    [1.016, 0.0, 0.5715, 1.0],
    [1.016, 0.0, 0.9525, 1.0],
    [1.016, 0.0, 1.3335, 1.0],
    [1.016, 0.0, 1.7145, 1.0],
    [1.016, 0.0, 2.0955, 1.0],
    [1.016, 0.0, 2.4765, 1.0],
    [1.016, 0.0, 2.76225, 1.0],
    [1.016, 0.0, 2.95275, 1.0],
    [1.016, 0.0, 3.048, 1.0],
    [0.99739704, 0.0449025006, 0.0, 0.98169],
    [0.99739704, 0.0449025006, 0.09350597249999999, 0.98169],
    [0.99739704, 0.0449025006, 0.2805179175, 0.98169],
    [0.99739704, 0.0449025006, 0.561035835, 0.98169],
    [0.99739704, 0.0449025006, 0.935059725, 0.98169],
    [0.99739704, 0.0449025006, 1.3090836149999998, 0.98169],
    [0.99739704, 0.0449025006, 1.6831075049999997, 0.98169],
    [0.99739704, 0.0449025006, 2.057131395, 0.98169],
    [0.99739704, 0.0449025006, 2.431155285, 0.98169],
    [0.99739704, 0.0449025006, 2.7116732024999997, 0.98169],
    [0.99739704, 0.0449025006, 2.8986851474999997, 0.98169],
    [0.99739704, 0.0449025006, 2.9921911199999998, 0.98169],
    [0.9580095146000002, 0.1325106488, 0.0, 0.94813],
    [0.9580095146000002, 0.1325106488, 0.09030938250000001, 0.94813],
    [0.9580095146000002, 0.1325106488, 0.2709281475, 0.94813],
    [0.9580095146000002, 0.1325106488, 0.541856295, 0.94813],
    [0.9580095146000002, 0.1325106488, 0.903093825, 0.94813],
    [0.9580095146000002, 0.1325106488, 1.264331355, 0.94813],
    [0.9580095146000002, 0.1325106488, 1.625568885, 0.94813],
    [0.9580095146000002, 0.1325106488, 1.986806415, 0.94813],
    [0.9580095146000002, 0.1325106488, 2.348043945, 0.94813],
    [0.9580095146000002, 0.1325106488, 2.6189720925, 0.94813],
    [0.9580095146000002, 0.1325106488, 2.7995908575, 0.94813],
    [0.9580095146000002, 0.1325106488, 2.8899002400000002, 0.94813],
    [0.8923571745, 0.257356132, 0.0, 0.90695],
    [0.8923571745, 0.257356132, 0.0863869875, 0.90695],
    [0.8923571745, 0.257356132, 0.25916096250000004, 0.90695],
    [0.8923571745, 0.257356132, 0.5183219250000001, 0.90695],
    [0.8923571745, 0.257356132, 0.863869875, 0.90695],
    [0.8923571745, 0.257356132, 1.209417825, 0.90695],
    [0.8923571745, 0.257356132, 1.5549657749999999, 0.90695],
    [0.8923571745, 0.257356132, 1.900513725, 0.90695],
    [0.8923571745, 0.257356132, 2.2460616750000004, 0.90695],
    [0.8923571745, 0.257356132, 2.5052226375, 0.90695],
    [0.8923571745, 0.257356132, 2.6779966125, 0.90695],
    [0.8923571745, 0.257356132, 2.7643836, 0.90695],
    [0.791652168, 0.4106565072, 0.0, 0.87033],
    [0.791652168, 0.4106565072, 0.08289893250000001, 0.87033],
    [0.791652168, 0.4106565072, 0.2486967975, 0.87033],
    [0.791652168, 0.4106565072, 0.497393595, 0.87033],
    [0.791652168, 0.4106565072, 0.8289893250000001, 0.87033],
    [0.791652168, 0.4106565072, 1.160585055, 0.87033],
    [0.791652168, 0.4106565072, 1.492180785, 0.87033],
    [0.791652168, 0.4106565072, 1.823776515, 0.87033],
    [0.791652168, 0.4106565072, 2.155372245, 0.87033],
    [0.791652168, 0.4106565072, 2.4040690425, 0.87033],
    [0.791652168, 0.4106565072, 2.5698669075000002, 0.87033],
    [0.791652168, 0.4106565072, 2.6527658400000003, 0.87033],
    [0.6778069056, 0.5508033138, 0.0, 0.85203],
    [0.6778069056, 0.5508033138, 0.0811558575, 0.85203],
    [0.6778069056, 0.5508033138, 0.24346757249999998, 0.85203],
    [0.6778069056, 0.5508033138, 0.48693514499999996, 0.85203],
    [0.6778069056, 0.5508033138, 0.811558575, 0.85203],
    [0.6778069056, 0.5508033138, 1.1361820049999998, 0.85203],
    [0.6778069056, 0.5508033138, 1.460805435, 0.85203],
    [0.6778069056, 0.5508033138, 1.7854288649999999, 0.85203],
    [0.6778069056, 0.5508033138, 2.110052295, 0.85203],
    [0.6778069056, 0.5508033138, 2.3535198674999998, 0.85203],
    [0.6778069056, 0.5508033138, 2.5158315824999997, 0.85203],
    [0.6778069056, 0.5508033138, 2.59698744, 0.85203],
    [0.5508033138, 0.6778069056, 0.0, 0.85203],
    [0.5508033138, 0.6778069056, 0.0811558575, 0.85203],
    [0.5508033138, 0.6778069056, 0.24346757249999998, 0.85203],
    [0.5508033138, 0.6778069056, 0.48693514499999996, 0.85203],
    [0.5508033138, 0.6778069056, 0.811558575, 0.85203],
    [0.5508033138, 0.6778069056, 1.1361820049999998, 0.85203],
    [0.5508033138, 0.6778069056, 1.460805435, 0.85203],
    [0.5508033138, 0.6778069056, 1.7854288649999999, 0.85203],
    [0.5508033138, 0.6778069056, 2.110052295, 0.85203],
    [0.5508033138, 0.6778069056, 2.3535198674999998, 0.85203],
    [0.5508033138, 0.6778069056, 2.5158315824999997, 0.85203],
    [0.5508033138, 0.6778069056, 2.59698744, 0.85203],
    [0.4106565072, 0.791652168, 0.0, 0.87033],
    [0.4106565072, 0.791652168, 0.08289893250000001, 0.87033],
    [0.4106565072, 0.791652168, 0.2486967975, 0.87033],
    [0.4106565072, 0.791652168, 0.497393595, 0.87033],
    [0.4106565072, 0.791652168, 0.8289893250000001, 0.87033],
    [0.4106565072, 0.791652168, 1.160585055, 0.87033],
    [0.4106565072, 0.791652168, 1.492180785, 0.87033],
    [0.4106565072, 0.791652168, 1.823776515, 0.87033],
    [0.4106565072, 0.791652168, 2.155372245, 0.87033],
    [0.4106565072, 0.791652168, 2.4040690425, 0.87033],
    [0.4106565072, 0.791652168, 2.5698669075000002, 0.87033],
    [0.4106565072, 0.791652168, 2.6527658400000003, 0.87033],
    [0.257356132, 0.8923571745, 0.0, 0.90695],
    [0.257356132, 0.8923571745, 0.0863869875, 0.90695],
    [0.257356132, 0.8923571745, 0.25916096250000004, 0.90695],
    [0.257356132, 0.8923571745, 0.5183219250000001, 0.90695],
    [0.257356132, 0.8923571745, 0.863869875, 0.90695],
    [0.257356132, 0.8923571745, 1.209417825, 0.90695],
    [0.257356132, 0.8923571745, 1.5549657749999999, 0.90695],
    [0.257356132, 0.8923571745, 1.900513725, 0.90695],
    [0.257356132, 0.8923571745, 2.2460616750000004, 0.90695],
    [0.257356132, 0.8923571745, 2.5052226375, 0.90695],
    [0.257356132, 0.8923571745, 2.6779966125, 0.90695],
    [0.257356132, 0.8923571745, 2.7643836, 0.90695],
    [0.1325106488, 0.9580095146000002, 0.0, 0.94813],
    [0.1325106488, 0.9580095146000002, 0.09030938250000001, 0.94813],
    [0.1325106488, 0.9580095146000002, 0.2709281475, 0.94813],
    [0.1325106488, 0.9580095146000002, 0.541856295, 0.94813],
    [0.1325106488, 0.9580095146000002, 0.903093825, 0.94813],
    [0.1325106488, 0.9580095146000002, 1.264331355, 0.94813],
    [0.1325106488, 0.9580095146000002, 1.625568885, 0.94813],
    [0.1325106488, 0.9580095146000002, 1.986806415, 0.94813],
    [0.1325106488, 0.9580095146000002, 2.348043945, 0.94813],
    [0.1325106488, 0.9580095146000002, 2.6189720925, 0.94813],
    [0.1325106488, 0.9580095146000002, 2.7995908575, 0.94813],
    [0.1325106488, 0.9580095146000002, 2.8899002400000002, 0.94813],
    [0.0449025006, 0.99739704, 0.0, 0.98169],
    [0.0449025006, 0.99739704, 0.09350597249999999, 0.98169],
    [0.0449025006, 0.99739704, 0.2805179175, 0.98169],
    [0.0449025006, 0.99739704, 0.561035835, 0.98169],
    [0.0449025006, 0.99739704, 0.935059725, 0.98169],
    [0.0449025006, 0.99739704, 1.3090836149999998, 0.98169],
    [0.0449025006, 0.99739704, 1.6831075049999997, 0.98169],
    [0.0449025006, 0.99739704, 2.057131395, 0.98169],
    [0.0449025006, 0.99739704, 2.431155285, 0.98169],
    [0.0449025006, 0.99739704, 2.7116732024999997, 0.98169],
    [0.0449025006, 0.99739704, 2.8986851474999997, 0.98169],
    [0.0449025006, 0.99739704, 2.9921911199999998, 0.98169],
    [0.0, 1.016, 0.0, 1.0],
    [0.0, 1.016, 0.09525, 1.0],
    [0.0, 1.016, 0.28575, 1.0],
    [0.0, 1.016, 0.5715, 1.0],
    [0.0, 1.016, 0.9525, 1.0],
    [0.0, 1.016, 1.3335, 1.0],
    [0.0, 1.016, 1.7145, 1.0],
    [0.0, 1.016, 2.0955, 1.0],
    [0.0, 1.016, 2.4765, 1.0],
    [0.0, 1.016, 2.76225, 1.0],
    [0.0, 1.016, 2.95275, 1.0],
    [0.0, 1.016, 3.048, 1.0],
])

# These are given in v,u , 21x21 mesh
controlPts = np.array([
[1.016               , 0.0                 , 0.0                  , 1.0]     ,
[1.016               , 0.0                 , 0.0381               , 1.0]     ,
[1.016               , 0.0                 , 0.1143               , 1.0]     ,
[1.016               , 0.0                 , 0.2286               , 1.0]     ,
[1.016               , 0.0                 , 0.381                , 1.0]     ,
[1.016               , 0.0                 , 0.5715               , 1.0]     ,
[1.016               , 0.0                 , 0.762                , 1.0]     ,
[1.016               , 0.0                 , 0.9525               , 1.0]     ,
[1.016               , 0.0                 , 1.143                , 1.0]     ,
[1.016               , 0.0                 , 1.3335               , 1.0]     ,
[1.016               , 0.0                 , 1.524                , 1.0]     ,
[1.016               , 0.0                 , 1.7145               , 1.0]     ,
[1.016               , 0.0                 , 1.905                , 1.0]     ,
[1.016               , 0.0                 , 2.0955               , 1.0]     ,
[1.016               , 0.0                 , 2.286                , 1.0]     ,
[1.016               , 0.0                 , 2.4765               , 1.0]     ,
[1.016               , 0.0                 , 2.667                , 1.0]     ,
[1.016               , 0.0                 , 2.8194               , 1.0]     ,
[1.016               , 0.0                 , 2.9337               , 1.0]     ,
[1.016               , 0.0                 , 3.0099               , 1.0]     ,
[1.016               , 0.0                 , 3.048                , 1.0]     ,
[1.00856288          , 0.0179575812        , 0.0                  , 0.99268] ,
[1.00856288          , 0.0179575812        , 0.037821108          , 0.99268] ,
[1.00856288          , 0.0179575812        , 0.113463324          , 0.99268] ,
[1.00856288          , 0.0179575812        , 0.226926648          , 0.99268] ,
[1.00856288          , 0.0179575812        , 0.37821108000000003  , 0.99268] ,
[1.00856288          , 0.0179575812        , 0.56731662           , 0.99268] ,
[1.00856288          , 0.0179575812        , 0.7564221600000001   , 0.99268] ,
[1.00856288          , 0.0179575812        , 0.9455277            , 0.99268] ,
[1.00856288          , 0.0179575812        , 1.13463324           , 0.99268] ,
[1.00856288          , 0.0179575812        , 1.32373878           , 0.99268] ,
[1.00856288          , 0.0179575812        , 1.5128443200000001   , 0.99268] ,
[1.00856288          , 0.0179575812        , 1.7019498599999998   , 0.99268] ,
[1.00856288          , 0.0179575812        , 1.8910554            , 0.99268] ,
[1.00856288          , 0.0179575812        , 2.08016094           , 0.99268] ,
[1.00856288          , 0.0179575812        , 2.26926648           , 0.99268] ,
[1.00856288          , 0.0179575812        , 2.45837202           , 0.99268] ,
[1.00856288          , 0.0179575812        , 2.64747756           , 0.99268] ,
[1.00856288          , 0.0179575812        , 2.7987619919999998   , 0.99268] ,
[1.00856288          , 0.0179575812        , 2.912225316          , 0.99268] ,
[1.00856288          , 0.0179575812        , 2.987867532          , 0.99268] ,
[1.00856288          , 0.0179575812        , 3.0256886400000003   , 0.99268] ,
[0.9933532631        , 0.0535527577        , 0.0                  , 0.97849] ,
[0.9933532631        , 0.0535527577        , 0.037280469000000004 , 0.97849] ,
[0.9933532631        , 0.0535527577        , 0.11184140699999999  , 0.97849] ,
[0.9933532631        , 0.0535527577        , 0.22368281399999998  , 0.97849] ,
[0.9933532631        , 0.0535527577        , 0.37280469           , 0.97849] ,
[0.9933532631        , 0.0535527577        , 0.559207035          , 0.97849] ,
[0.9933532631        , 0.0535527577        , 0.74560938           , 0.97849] ,
[0.9933532631        , 0.0535527577        , 0.932011725          , 0.97849] ,
[0.9933532631        , 0.0535527577        , 1.11841407           , 0.97849] ,
[0.9933532631        , 0.0535527577        , 1.304816415          , 0.97849] ,
[0.9933532631        , 0.0535527577        , 1.49121876           , 0.97849] ,
[0.9933532631        , 0.0535527577        , 1.6776211049999998   , 0.97849] ,
[0.9933532631        , 0.0535527577        , 1.86402345           , 0.97849] ,
[0.9933532631        , 0.0535527577        , 2.0504257949999998   , 0.97849] ,
[0.9933532631        , 0.0535527577        , 2.23682814           , 0.97849] ,
[0.9933532631        , 0.0535527577        , 2.423230485          , 0.97849] ,
[0.9933532631        , 0.0535527577        , 2.60963283           , 0.97849] ,
[0.9933532631        , 0.0535527577        , 2.758754706          , 0.97849] ,
[0.9933532631        , 0.0535527577        , 2.870596113          , 0.97849] ,
[0.9933532631        , 0.0535527577        , 2.945157051          , 0.97849] ,
[0.9933532631        , 0.0535527577        , 2.98243752           , 0.97849] ,
[0.969555741         , 0.10595184740000001 , 0.0                  , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 0.036521898000000004 , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 0.10956569399999999  , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 0.21913138799999998  , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 0.36521898           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 0.54782847           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 0.73043796           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 0.91304745           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 1.09565694           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 1.27826643           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 1.46087592           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 1.6434854099999998   , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 1.8260949            , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 2.00870439           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 2.19131388           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 2.37392337           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 2.55653286           , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 2.7026204519999997   , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 2.8121861459999997   , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 2.885229942          , 0.95858] ,
[0.969555741         , 0.10595184740000001 , 2.92175184           , 0.95858] ,
[0.9358556605999999  , 0.1738522442        , 0.0                  , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 0.035615499          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 0.106846497          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 0.213692994          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 0.35615499           , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 0.534232485          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 0.71230998           , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 0.890387475          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 1.06846497           , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 1.2465424649999999   , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 1.42461996           , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 1.602697455          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 1.78077495           , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 1.958852445          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 2.13692994           , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 2.315007435          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 2.4930849299999998   , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 2.635546926          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 2.742393423          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 2.813624421          , 0.93479] ,
[0.9358556605999999  , 0.1738522442        , 2.84923992           , 0.93479] ,
[0.8904263251        , 0.25543668020000004 , 0.0                  , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 0.034656141          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 0.103968423          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 0.207936846          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 0.34656141           , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 0.519842115          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 0.69312282           , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 0.8664035250000001   , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 1.03968423           , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 1.212964935          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 1.38624564           , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 1.5595263449999999   , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 1.7328070500000001   , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 1.906087755          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 2.07936846           , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 2.2526491650000002   , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 2.42592987           , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 2.564554434          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 2.668522857          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 2.737835139          , 0.90961] ,
[0.8904263251        , 0.25543668020000004 , 2.77249128           , 0.90961] ,
[0.8417330262        , 0.33372921780000003 , 0.0                  , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 0.033871662000000004 , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 0.101614986          , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 0.203229972          , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 0.33871662           , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 0.50807493           , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 0.67743324           , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 0.8467915500000001   , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 1.01614986           , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 1.1855081699999999   , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 1.35486648           , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 1.5242247899999999   , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 1.6935831000000001   , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 1.86294141           , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 2.03229972           , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 2.2016580300000004   , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 2.3710163399999997   , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 2.506502988          , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 2.6081179740000002   , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 2.675861298          , 0.88902] ,
[0.8417330262        , 0.33372921780000003 , 2.70973296           , 0.88902] ,
[0.78973326          , 0.4087386           , 0.0                  , 0.873]   ,
[0.78973326          , 0.4087386           , 0.0332613            , 0.873]   ,
[0.78973326          , 0.4087386           , 0.0997839            , 0.873]   ,
[0.78973326          , 0.4087386           , 0.1995678            , 0.873]   ,
[0.78973326          , 0.4087386           , 0.332613             , 0.873]   ,
[0.78973326          , 0.4087386           , 0.4989195            , 0.873]   ,
[0.78973326          , 0.4087386           , 0.665226             , 0.873]   ,
[0.78973326          , 0.4087386           , 0.8315325            , 0.873]   ,
[0.78973326          , 0.4087386           , 0.997839             , 0.873]   ,
[0.78973326          , 0.4087386           , 1.1641454999999998   , 0.873]   ,
[0.78973326          , 0.4087386           , 1.330452             , 0.873]   ,
[0.78973326          , 0.4087386           , 1.4967584999999999   , 0.873]   ,
[0.78973326          , 0.4087386           , 1.663065             , 0.873]   ,
[0.78973326          , 0.4087386           , 1.8293715            , 0.873]   ,
[0.78973326          , 0.4087386           , 1.995678             , 0.873]   ,
[0.78973326          , 0.4087386           , 2.1619845            , 0.873]   ,
[0.78973326          , 0.4087386           , 2.3282909999999997   , 0.873]   ,
[0.78973326          , 0.4087386           , 2.4613362            , 0.873]   ,
[0.78973326          , 0.4087386           , 2.5611201            , 0.873]   ,
[0.78973326          , 0.4087386           , 2.6276427            , 0.873]   ,
[0.78973326          , 0.4087386           , 2.660904             , 0.873]   ,
[0.7344540531999999  , 0.48045754960000003 , 0.0                  , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 0.032825436          , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 0.098476308          , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 0.196952616          , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 0.32825436           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 0.49238154           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 0.65650872           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 0.8206359            , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 0.98476308           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 1.14889026           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 1.31301744           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 1.47714462           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 1.6412718            , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 1.8053989799999999   , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 1.96952616           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 2.13365334           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 2.29778052           , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 2.429082264          , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 2.527558572          , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 2.593209444          , 0.86156] ,
[0.7344540531999999  , 0.48045754960000003 , 2.62603488           , 0.86156] ,
[0.675888213         , 0.54888834          , 0.0                  , 0.8547]  ,
[0.675888213         , 0.54888834          , 0.03256407           , 0.8547]  ,
[0.675888213         , 0.54888834          , 0.09769221           , 0.8547]  ,
[0.675888213         , 0.54888834          , 0.19538442           , 0.8547]  ,
[0.675888213         , 0.54888834          , 0.3256407            , 0.8547]  ,
[0.675888213         , 0.54888834          , 0.48846105           , 0.8547]  ,
[0.675888213         , 0.54888834          , 0.6512814            , 0.8547]  ,
[0.675888213         , 0.54888834          , 0.8141017500000001   , 0.8547]  ,
[0.675888213         , 0.54888834          , 0.9769221            , 0.8547]  ,
[0.675888213         , 0.54888834          , 1.13974245           , 0.8547]  ,
[0.675888213         , 0.54888834          , 1.3025628            , 0.8547]  ,
[0.675888213         , 0.54888834          , 1.4653831499999999   , 0.8547]  ,
[0.675888213         , 0.54888834          , 1.6282035000000001   , 0.8547]  ,
[0.675888213         , 0.54888834          , 1.79102385           , 0.8547]  ,
[0.675888213         , 0.54888834          , 1.9538442            , 0.8547]  ,
[0.675888213         , 0.54888834          , 2.1166645500000003   , 0.8547]  ,
[0.675888213         , 0.54888834          , 2.2794849            , 0.8547]  ,
[0.675888213         , 0.54888834          , 2.40974118           , 0.8547]  ,
[0.675888213         , 0.54888834          , 2.50743339           , 0.8547]  ,
[0.675888213         , 0.54888834          , 2.57256153           , 0.8547]  ,
[0.675888213         , 0.54888834          , 2.6051256            , 0.8547]  ,
[0.6140335435000001  , 0.6140335435000001  , 0.0                  , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 0.032476821          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 0.097430463          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 0.194860926          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 0.32476821           , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 0.487152315          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 0.64953642           , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 0.811920525          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 0.97430463           , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 1.136688735          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 1.29907284           , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 1.461456945          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 1.62384105           , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 1.786225155          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 1.94860926           , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 2.110993365          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 2.27337747           , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 2.403284754          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 2.5007152169999998   , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 2.565668859          , 0.85241] ,
[0.6140335435000001  , 0.6140335435000001  , 2.59814568           , 0.85241] ,
[0.54888834          , 0.675888213         , 0.0                  , 0.8547]  ,
[0.54888834          , 0.675888213         , 0.03256407           , 0.8547]  ,
[0.54888834          , 0.675888213         , 0.09769221           , 0.8547]  ,
[0.54888834          , 0.675888213         , 0.19538442           , 0.8547]  ,
[0.54888834          , 0.675888213         , 0.3256407            , 0.8547]  ,
[0.54888834          , 0.675888213         , 0.48846105           , 0.8547]  ,
[0.54888834          , 0.675888213         , 0.6512814            , 0.8547]  ,
[0.54888834          , 0.675888213         , 0.8141017500000001   , 0.8547]  ,
[0.54888834          , 0.675888213         , 0.9769221            , 0.8547]  ,
[0.54888834          , 0.675888213         , 1.13974245           , 0.8547]  ,
[0.54888834          , 0.675888213         , 1.3025628            , 0.8547]  ,
[0.54888834          , 0.675888213         , 1.4653831499999999   , 0.8547]  ,
[0.54888834          , 0.675888213         , 1.6282035000000001   , 0.8547]  ,
[0.54888834          , 0.675888213         , 1.79102385           , 0.8547]  ,
[0.54888834          , 0.675888213         , 1.9538442            , 0.8547]  ,
[0.54888834          , 0.675888213         , 2.1166645500000003   , 0.8547]  ,
[0.54888834          , 0.675888213         , 2.2794849            , 0.8547]  ,
[0.54888834          , 0.675888213         , 2.40974118           , 0.8547]  ,
[0.54888834          , 0.675888213         , 2.50743339           , 0.8547]  ,
[0.54888834          , 0.675888213         , 2.57256153           , 0.8547]  ,
[0.54888834          , 0.675888213         , 2.6051256            , 0.8547]  ,
[0.48045754960000003 , 0.7344540531999999  , 0.0                  , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 0.032825436          , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 0.098476308          , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 0.196952616          , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 0.32825436           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 0.49238154           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 0.65650872           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 0.8206359            , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 0.98476308           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 1.14889026           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 1.31301744           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 1.47714462           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 1.6412718            , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 1.8053989799999999   , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 1.96952616           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 2.13365334           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 2.29778052           , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 2.429082264          , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 2.527558572          , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 2.593209444          , 0.86156] ,
[0.48045754960000003 , 0.7344540531999999  , 2.62603488           , 0.86156] ,
[0.4087386           , 0.78973326          , 0.0                  , 0.873]   ,
[0.4087386           , 0.78973326          , 0.0332613            , 0.873]   ,
[0.4087386           , 0.78973326          , 0.0997839            , 0.873]   ,
[0.4087386           , 0.78973326          , 0.1995678            , 0.873]   ,
[0.4087386           , 0.78973326          , 0.332613             , 0.873]   ,
[0.4087386           , 0.78973326          , 0.4989195            , 0.873]   ,
[0.4087386           , 0.78973326          , 0.665226             , 0.873]   ,
[0.4087386           , 0.78973326          , 0.8315325            , 0.873]   ,
[0.4087386           , 0.78973326          , 0.997839             , 0.873]   ,
[0.4087386           , 0.78973326          , 1.1641454999999998   , 0.873]   ,
[0.4087386           , 0.78973326          , 1.330452             , 0.873]   ,
[0.4087386           , 0.78973326          , 1.4967584999999999   , 0.873]   ,
[0.4087386           , 0.78973326          , 1.663065             , 0.873]   ,
[0.4087386           , 0.78973326          , 1.8293715            , 0.873]   ,
[0.4087386           , 0.78973326          , 1.995678             , 0.873]   ,
[0.4087386           , 0.78973326          , 2.1619845            , 0.873]   ,
[0.4087386           , 0.78973326          , 2.3282909999999997   , 0.873]   ,
[0.4087386           , 0.78973326          , 2.4613362            , 0.873]   ,
[0.4087386           , 0.78973326          , 2.5611201            , 0.873]   ,
[0.4087386           , 0.78973326          , 2.6276427            , 0.873]   ,
[0.4087386           , 0.78973326          , 2.660904             , 0.873]   ,
[0.33372921780000003 , 0.8417330262        , 0.0                  , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 0.033871662000000004 , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 0.101614986          , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 0.203229972          , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 0.33871662           , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 0.50807493           , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 0.67743324           , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 0.8467915500000001   , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 1.01614986           , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 1.1855081699999999   , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 1.35486648           , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 1.5242247899999999   , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 1.6935831000000001   , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 1.86294141           , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 2.03229972           , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 2.2016580300000004   , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 2.3710163399999997   , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 2.506502988          , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 2.6081179740000002   , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 2.675861298          , 0.88902] ,
[0.33372921780000003 , 0.8417330262        , 2.70973296           , 0.88902] ,
[0.25543668020000004 , 0.8904263251        , 0.0                  , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 0.034656141          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 0.103968423          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 0.207936846          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 0.34656141           , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 0.519842115          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 0.69312282           , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 0.8664035250000001   , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 1.03968423           , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 1.212964935          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 1.38624564           , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 1.5595263449999999   , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 1.7328070500000001   , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 1.906087755          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 2.07936846           , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 2.2526491650000002   , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 2.42592987           , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 2.564554434          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 2.668522857          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 2.737835139          , 0.90961] ,
[0.25543668020000004 , 0.8904263251        , 2.77249128           , 0.90961] ,
[0.1738522442        , 0.9358556605999999  , 0.0                  , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 0.035615499          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 0.106846497          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 0.213692994          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 0.35615499           , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 0.534232485          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 0.71230998           , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 0.890387475          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 1.06846497           , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 1.2465424649999999   , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 1.42461996           , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 1.602697455          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 1.78077495           , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 1.958852445          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 2.13692994           , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 2.315007435          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 2.4930849299999998   , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 2.635546926          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 2.742393423          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 2.813624421          , 0.93479] ,
[0.1738522442        , 0.9358556605999999  , 2.84923992           , 0.93479] ,
[0.10595184740000001 , 0.969555741         , 0.0                  , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 0.036521898000000004 , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 0.10956569399999999  , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 0.21913138799999998  , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 0.36521898           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 0.54782847           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 0.73043796           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 0.91304745           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 1.09565694           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 1.27826643           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 1.46087592           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 1.6434854099999998   , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 1.8260949            , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 2.00870439           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 2.19131388           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 2.37392337           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 2.55653286           , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 2.7026204519999997   , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 2.8121861459999997   , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 2.885229942          , 0.95858] ,
[0.10595184740000001 , 0.969555741         , 2.92175184           , 0.95858] ,
[0.0535527577        , 0.9933532631        , 0.0                  , 0.97849] ,
[0.0535527577        , 0.9933532631        , 0.037280469000000004 , 0.97849] ,
[0.0535527577        , 0.9933532631        , 0.11184140699999999  , 0.97849] ,
[0.0535527577        , 0.9933532631        , 0.22368281399999998  , 0.97849] ,
[0.0535527577        , 0.9933532631        , 0.37280469           , 0.97849] ,
[0.0535527577        , 0.9933532631        , 0.559207035          , 0.97849] ,
[0.0535527577        , 0.9933532631        , 0.74560938           , 0.97849] ,
[0.0535527577        , 0.9933532631        , 0.932011725          , 0.97849] ,
[0.0535527577        , 0.9933532631        , 1.11841407           , 0.97849] ,
[0.0535527577        , 0.9933532631        , 1.304816415          , 0.97849] ,
[0.0535527577        , 0.9933532631        , 1.49121876           , 0.97849] ,
[0.0535527577        , 0.9933532631        , 1.6776211049999998   , 0.97849] ,
[0.0535527577        , 0.9933532631        , 1.86402345           , 0.97849] ,
[0.0535527577        , 0.9933532631        , 2.0504257949999998   , 0.97849] ,
[0.0535527577        , 0.9933532631        , 2.23682814           , 0.97849] ,
[0.0535527577        , 0.9933532631        , 2.423230485          , 0.97849] ,
[0.0535527577        , 0.9933532631        , 2.60963283           , 0.97849] ,
[0.0535527577        , 0.9933532631        , 2.758754706          , 0.97849] ,
[0.0535527577        , 0.9933532631        , 2.870596113          , 0.97849] ,
[0.0535527577        , 0.9933532631        , 2.945157051          , 0.97849] ,
[0.0535527577        , 0.9933532631        , 2.98243752           , 0.97849] ,
[0.0179575812        , 1.00856288          , 0.0                  , 0.99268] ,
[0.0179575812        , 1.00856288          , 0.037821108          , 0.99268] ,
[0.0179575812        , 1.00856288          , 0.113463324          , 0.99268] ,
[0.0179575812        , 1.00856288          , 0.226926648          , 0.99268] ,
[0.0179575812        , 1.00856288          , 0.37821108000000003  , 0.99268] ,
[0.0179575812        , 1.00856288          , 0.56731662           , 0.99268] ,
[0.0179575812        , 1.00856288          , 0.7564221600000001   , 0.99268] ,
[0.0179575812        , 1.00856288          , 0.9455277            , 0.99268] ,
[0.0179575812        , 1.00856288          , 1.13463324           , 0.99268] ,
[0.0179575812        , 1.00856288          , 1.32373878           , 0.99268] ,
[0.0179575812        , 1.00856288          , 1.5128443200000001   , 0.99268] ,
[0.0179575812        , 1.00856288          , 1.7019498599999998   , 0.99268] ,
[0.0179575812        , 1.00856288          , 1.8910554            , 0.99268] ,
[0.0179575812        , 1.00856288          , 2.08016094           , 0.99268] ,
[0.0179575812        , 1.00856288          , 2.26926648           , 0.99268] ,
[0.0179575812        , 1.00856288          , 2.45837202           , 0.99268] ,
[0.0179575812        , 1.00856288          , 2.64747756           , 0.99268] ,
[0.0179575812        , 1.00856288          , 2.7987619919999998   , 0.99268] ,
[0.0179575812        , 1.00856288          , 2.912225316          , 0.99268] ,
[0.0179575812        , 1.00856288          , 2.987867532          , 0.99268] ,
[0.0179575812        , 1.00856288          , 3.0256886400000003   , 0.99268] ,
[0.0                 , 1.016               , 0.0                  , 1.0]     ,
[0.0                 , 1.016               , 0.0381               , 1.0]     ,
[0.0                 , 1.016               , 0.1143               , 1.0]     ,
[0.0                 , 1.016               , 0.2286               , 1.0]     ,
[0.0                 , 1.016               , 0.381                , 1.0]     ,
[0.0                 , 1.016               , 0.5715               , 1.0]     ,
[0.0                 , 1.016               , 0.762                , 1.0]     ,
[0.0                 , 1.016               , 0.9525               , 1.0]     ,
[0.0                 , 1.016               , 1.143                , 1.0]     ,
[0.0                 , 1.016               , 1.3335               , 1.0]     ,
[0.0                 , 1.016               , 1.524                , 1.0]     ,
[0.0                 , 1.016               , 1.7145               , 1.0]     ,
[0.0                 , 1.016               , 1.905                , 1.0]     ,
[0.0                 , 1.016               , 2.0955               , 1.0]     ,
[0.0                 , 1.016               , 2.286                , 1.0]     ,
[0.0                 , 1.016               , 2.4765               , 1.0]     ,
[0.0                 , 1.016               , 2.667                , 1.0]     ,
[0.0                 , 1.016               , 2.8194               , 1.0]     ,
[0.0                 , 1.016               , 2.9337               , 1.0]     ,
[0.0                 , 1.016               , 3.0099               , 1.0]     ,
[0.0                 , 1.016               , 3.048                , 1.0]
])



patchTag = 1
P = 5 # with 4 it gets close
Q = 5

# Create a BSpline surface instance
surfR = NURBS.Surface()

# Set surface degrees
surfR.degree_u = P
surfR.degree_v = Q

# Setting control points for surface
surfR.set_ctrlpts(controlPts.tolist(), 21, 21)

# Set knot vectors
surfR.knotvector_u = knotvector.generate(surfR.degree_u, surfR.ctrlpts_size_u)
surfR.knotvector_v = knotvector.generate(surfR.degree_v, surfR.ctrlpts_size_v)


# Visualize surface
surfVisualize(surfR, hold=True)

bbox = np.array(surfR.bbox)
midPoint = (bbox[1] - bbox[0]) / 2


surfL = operations.rotate(surfR, 0, axis=1, inplace=False)
ctrlpts_surfL = surfL.ctrlpts2d[:]
for dim in ctrlpts_surfL:
    for point in dim:
        point[0] *= -1  # Symmetry along x axis

ctrlpts_surfL.reverse()  # Flipping

ctrlpts_surfL = (np.array(ctrlpts_surfL).reshape(surfL.ctrlpts_size_u * surfL.ctrlpts_size_v, 4))
surfL.set_ctrlpts(ctrlpts_surfL.tolist(), surfL.ctrlpts_size_u, surfL.ctrlpts_size_v)


# Creating bending strip

from edgeHandler import *

interfacePoints, nodesOnLeftPatch = edgeGetter(surfL, "00", "01")

nodesOnRightPatch = edgeGetter(surfR, "10", "11")[1]

bendingStrip = makeBendingStrip(nodesOnRightPatch, interfacePoints, nodesOnLeftPatch)

# Creating container for multipatches

surfList = [surfR, surfL, bendingStrip]


container = multi.SurfaceContainer(surfList)

# Visualize surface

container.sample_size = 30
for surf in container:
    surf.evaluate()

# Visualization configuration
container.vis = VisMPL.VisSurface(ctrlpts=True, legend=False)
# container.vis.ctrlpts_offset=0.1

# Render the surface
evalcolor = ["green", "green", 'blue']
container.render(evalcolor=evalcolor)


# Declaring material properties

E1 = 2.0685e7   # Young's modulus N/m^2
E2 = E1/(2068.5/517.125) 
nu12 = 0.3  # Poisson's ratio
nu21 = nu12*E2/E1  # Poisson's ratio
G12 = E1/2068.5*795.6  # Shear modulus
rho = 0.5e2  # *9.807 # kg/m^3



tagPlaneStress1 = 1
ops.nDMaterial("ElasticOrthotropicPlaneStress", tagPlaneStress1, E1, E2, nu12, nu21, G12, rho)

tagPlaneStress2 = 2
ops.nDMaterial("ElasticOrthotropicPlaneStress", tagPlaneStress2, E1, E2, nu12, nu21, G12, rho)

tagPlaneStress3 = 3
ops.nDMaterial("ElasticOrthotropicPlaneStress", tagPlaneStress3, E1, E2, nu12, nu21, G12, rho)

tagPlaneStress4 = 4
ops.nDMaterial("ElasticOrthotropicPlaneStress", tagPlaneStress4, E1 * 1e3, E1 * 1e3, 0, 0, 0, rho)

deg2rad = pi / 180


matTags = [1,1,1]
thickness = [1.0/100, 1.0/100, 1.0/100]
θ = [90 * deg2rad, 0 * deg2rad, 90 * deg2rad]

gFact = [0.0, 0.0, 0.0]


Nlayers = len(θ)


names = ["leftPatch", "rightPatch", "bendingStrip"]
shellType = 'KLShell'
patchTag = 1
nodeStartTag = 1

nodesMap = []

for i in range(len(container)):
    surf = container[i]
    name = names[i]

    # Identifying bending strip
    if name == "bendingStrip":
        matTags=[4,4,4]
        shellType = "KLShell_BendingStrip"

    # Flipping control point to u,v format
    controlPts = surf.ctrlpts2d[:]
    controlPts = np.array(compatibility.flip_ctrlpts2d(controlPts))

    for dim in controlPts:  # Unweighting control pts
        for point in dim:
            point[0:3] /= point[3]

    # Creating a Patch in OpenSees
    ops.IGA("Patch", patchTag, nodeStartTag, surf.degree_u, surf.degree_v, surf.ctrlpts_size_u, surf.ctrlpts_size_v,
            "-type", shellType,
            # "-nonLinearGeometry", 0,
            "-planeStressMatTags", *matTags,
            "-gFact", *gFact,
            "-theta", *θ,
            "-thickness", *thickness,
            "-uKnot", *surf.knotvector_u, "-vKnot", *surf.knotvector_v, "-controlPts", *controlPts.flatten())

    # Get the nodes on current patch
    nodesMap.append(np.arange(nodeStartTag, ops.getNodeTags()[-1] + 1).tolist())

    # Update patchTag, nodeStartTag and materialTag
    lastElTag = ops.getEleTags()[-1]
    lastNodeTag = ops.getNodeTags()[-1]
    patchTag = lastElTag + 1
    nodeStartTag = lastNodeTag + 1


print("\n\n\nPRINTING DOMAIN-----------------------")
ops.printModel()
print("\n\n\nDONE PRINTING DOMAIN-----------------------")


# Getting surfR info
print("\nGetting surfR info\n")
nPoints_R = surfR.ctrlpts_size_u * surfR.ctrlpts_size_v

fixedNodes_R = np.arange(1, surfR.ctrlpts_size_u + 1, 1)
nextToFixedNodes_R = fixedNodes_R + surfR.ctrlpts_size_u

hingedNodes_R = np.arange(1, nPoints_R+1, surfR.ctrlpts_size_v)
nextToHingedNodes_R = hingedNodes_R + 1


middleNodes_R = np.arange(surfR.ctrlpts_size_u, nPoints_R + 1, surfR.ctrlpts_size_v)
nextToMiddleNodes_R = middleNodes_R - 1


# print("fixedNodes_R: ", fixedNodes_R)
# print("nextToFixedNodes_R: ", nextToFixedNodes_R)
# print("hingedNodes_R: ", hingedNodes_R)
# print("nextToHingedNodes_R: ", nextToHingedNodes_R)
# print("middleNodes_R: ", middleNodes_R)
# print("nextToMiddleNodes_R: ", nextToMiddleNodes_R)

# Getting surfL info
print("\nGetting surfL info\n")
nPoints_L = surfL.ctrlpts_size_u * surfL.ctrlpts_size_v

fixedNodes_L = np.arange(1, surfL.ctrlpts_size_u + 1, 1) + nPoints_R
nextToFixedNodes_L = fixedNodes_L + surfL.ctrlpts_size_u

middleNodes_L = np.arange(1, nPoints_L, surfL.ctrlpts_size_v) + nPoints_R
nextToMiddleNodes_L = middleNodes_L + 1


hingedNodes_L = np.arange(surfL.ctrlpts_size_u, nPoints_L + 1, surfL.ctrlpts_size_v) + nPoints_R
nextToHingedNodes_L = hingedNodes_L - 1



# print("fixedNodes_L: ", fixedNodes_L)
# print("nextToFixedNodes_L: ", nextToFixedNodes_L)
# print("hingedNodes_L: ", hingedNodes_L)
# print("nextToHingedNodes_L: ", nextToHingedNodes_L)
# print("middleNodes_L: ", middleNodes_L)
# print("nextToMiddleNodes_L: ", nextToMiddleNodes_L)

fixedNodes = np.unique(np.concatenate([fixedNodes_L, fixedNodes_R, nextToFixedNodes_L, nextToFixedNodes_R]) ) # Two rows fixed for clamping
middleNodes = np.unique(np.concatenate([middleNodes_R]))
hingedNodes = np.unique(np.concatenate([hingedNodes_L, hingedNodes_R]))


for n in ops.getNodeTags():
    if n in fixedNodes:
        ops.fix(n, 1, 1, 1)
    elif n in middleNodes:
        ops.fix(n, 1, 0, 0)
    elif n in hingedNodes:
        ops.fix(n, 0, 1, 0)
    # elif n in nextToHingedNodes_L:
    #     ops.fix(n, 0, 1, 0)
    # elif n in nextToHingedNodes_R:
    #     ops.fix(n, 0, 1, 0)



# EqualDofing overlapping points (constrainer Right, retained Left)

for i in range(len(middleNodes_R)):
    retainedNode = int(middleNodes_R[i])
    constrainedNode = int(middleNodes_L[i])
    ops.equalDOF(retainedNode, constrainedNode, 1, 2, 3)

# EqualDofing bending strip with constrainerNodes

# Retaining Nodes
firstRow_r = nextToMiddleNodes_R
secondRow_r = middleNodes_R
thirdRow_r = nextToMiddleNodes_L

# Constrained nodes
nodesOnBendingStrip = nodesMap[2]

firstRow_c = []
secondRow_c = []
thirdRow_c = []

firstRow_c=(nodesOnBendingStrip[:len(firstRow_r)])
secondRow_c=(nodesOnBendingStrip[len(firstRow_r):2*len(firstRow_r)])
thirdRow_c=(nodesOnBendingStrip[2*len(firstRow_r):])

# for i in range(int(len(nodesOnBendingStrip)/3)):
#     firstRow_c.append(nodesOnBendingStrip[3 * i ])
#     secondRow_c.append(nodesOnBendingStrip[3 * i + 1])
#     thirdRow_c.append(nodesOnBendingStrip[3 * i + 2])


for i in range(len(firstRow_c)):
    retainedNode = int(firstRow_r[i])
    constrainedNode = int(firstRow_c[i])
    ops.equalDOF(retainedNode, constrainedNode, 1, 2, 3)


for i in range(len(secondRow_c)):
    retainedNode = int(secondRow_r[i])
    constrainedNode = int(secondRow_c[i])
    ops.equalDOF(retainedNode, constrainedNode, 1, 2, 3)


for i in range(len(thirdRow_c)):
    retainedNode = int(thirdRow_r[i])
    constrainedNode = int(thirdRow_c[i])
    ops.equalDOF(retainedNode, constrainedNode, 1, 2, 3)



# EqualDofing Hinged Nodes for symmetry condition

for i in range(len(hingedNodes_L)):
    ops.equalDOF(int(hingedNodes_L[i]), int(nextToHingedNodes_L[i]), 1,2,3)
    ops.equalDOF(int(hingedNodes_R[i]), int(nextToHingedNodes_R[i]), 1,2,3)    

    # ops.equalDOF(int(hingedNodes_L[i]), int(nextToHingedNodes_L[i]), 1,2,3)
    # ops.equalDOF(int(hingedNodes_R[i]), int(nextToHingedNodes_R[i]), 1,2,3)
    
    # ops.equalDOF(int(nextToHingedNodes_L[i]), int(hingedNodes_L[i]), 1,2,3)
    # ops.equalDOF(int(nextToHingedNodes_R[i]), int(hingedNodes_R[i]), 1,2,3)



print("\n\n\nPRINTING DOMAIN-----------------------")
ops.printModel()
print("\n\n\nDONE PRINTING DOMAIN-----------------------")


# ------------------------------
# Start of analysis generation
# ------------------------------

# create TimeSeries
ops.timeSeries("Linear", 1)

# create a plain load pattern
ops.pattern("Plain", 1, 1)


print("Loading nodes")

Pz = 2000.0 
nodeToLoad=surfR.ctrlpts_size_u*surfR.ctrlpts_size_v
ops.load(nodeToLoad, 0, -Pz , 0)


print("Finished loading nodes")


print("Starting analysis")

# Create test
# ops.test("NormDispIncr", 0.5e-3, 60, 1) # Apparently correct
# ops.test("RelativeNormDispIncr", 1.0e-3, 50, 1) # Apparently faster
ops.test("NormUnbalance", 1.0e-5, 60, 1)
# ops.test("EnergyIncr", 1.0e-2, 50, 1)
# ops.test("RelativeEnergyIncr", 1.0e-3, 50, 1)


# create SOE
ops.system("UmfPack")
# ops.system("SparseSYM")

# create DOF number
# ops.numberer("Plain")
ops.numberer("RCM")

# create constraint handler
ops.constraints("Plain")
# ops.constraints("Lagrange")
# ops.constraints("Penalty",1e8,1e8)


# ops.algorithm("Linear")
# ops.algorithm("Newton")
# ops.algorithm("SecantNewton")
# ops.algorithm("NewtonLineSearch", 'type', 'Secant')
# ops.algorithm("NewtonLineSearch", 'type', 'RegulaFalsi')
ops.algorithm("NewtonLineSearch", 'type', 'Bisection')
# ops.algorithm("NewtonLineSearch")
# ops.algorithm("ModifiedNewton")
# ops.algorithm("KrylovNewton")
# ops.algorithm("BFGS")
# ops.algorithm("Broyden")

## create integrator
delta = -0.1/2 #0.1/2 made it to 1.55
defMax = 2.00983
nSteps = abs(int(defMax / delta))
ops.integrator("DisplacementControl", nodeToLoad, 2, delta)

# nSteps=1
# ops.integrator("LoadControl", 1.0 /nSteps)

# create analysis object
ops.analysis("Static")


# perform the analysis
import matplotlib.pyplot as plt
data = np.zeros((nSteps + 1, 2))

for j in range(nSteps):
    print("=================================")
    print(f"Load step {j}")
    print("=================================")
    result = ops.analyze(1)
    if result != 0:
        break
        exit(-1)
    else:
        # Adding deformation to control points
        fdef = 1e0
        for i in range(len(container)):
            surf=container[i]
            nodes=nodesMap[i]
            controlPts = np.array(compatibility.flip_ctrlpts2d(surf.ctrlpts2d[:])).reshape([surf.ctrlpts_size_v * surf.ctrlpts_size_u, 4]).tolist()
            for n in nodes:
                # Get node position in list
                indexN = nodes.index(n)
                point = controlPts[indexN]

                # Add deformation scaled by fdef
                weight=point[3]
                point[0] = (ops.nodeCoord(n)[0] + fdef * ops.nodeDisp(n)[0])*weight
                point[1] = (ops.nodeCoord(n)[1] + fdef * ops.nodeDisp(n)[1])*weight
                point[2] = (ops.nodeCoord(n)[2] + fdef * ops.nodeDisp(n)[2])*weight


            nPoints=surf.ctrlpts_size_u*surf.ctrlpts_size_v
            shape=np.array(compatibility.flip_ctrlpts2d(surf.ctrlpts2d[:])).shape
            controlPts=np.array(controlPts).reshape(shape)
            controlPts=np.array(compatibility.flip_ctrlpts2d(controlPts))

            surf.set_ctrlpts(controlPts.reshape(nPoints,4).tolist(), surf.ctrlpts_size_u, surf.ctrlpts_size_v)

        if j == nSteps-1:
            # Visualizing deformed surface
            container.sample_size = 60
            for surf in container:
                surf.evaluate()
                
            # Visualization configuration
            container.vis = VisVTK.VisSurface(ctrlpts=True, legend=False, line_width=0.1)

            # Render the surface
            evalcolor = ["green", "green", 'black']
            cpcolor=["green","green","black"]
            container.render(evalcolor=evalcolor, cpcolor=cpcolor, plot=True)

        for i in range(len(container)):
            surf=container[i]
            nodes=nodesMap[i]
            controlPts = np.array(compatibility.flip_ctrlpts2d(surf.ctrlpts2d[:])).reshape([surf.ctrlpts_size_v * surf.ctrlpts_size_u, 4]).tolist()
            for n in nodes:
                # Get node position in list
                indexN = nodes.index(n)
                point = controlPts[indexN]

                # Add deformation scaled by fdef
                weight=point[3]
                point[0] = (ops.nodeCoord(n)[0] - fdef * ops.nodeDisp(n)[0])*weight
                point[1] = (ops.nodeCoord(n)[1] - fdef * ops.nodeDisp(n)[1])*weight
                point[2] = (ops.nodeCoord(n)[2] - fdef * ops.nodeDisp(n)[2])*weight


            nPoints=surf.ctrlpts_size_u*surf.ctrlpts_size_v
            shape=np.array(compatibility.flip_ctrlpts2d(surf.ctrlpts2d[:])).shape
            controlPts=np.array(controlPts).reshape(shape)
            controlPts=np.array(compatibility.flip_ctrlpts2d(controlPts))

            surf.set_ctrlpts(controlPts.reshape(nPoints,4).tolist(), surf.ctrlpts_size_u, surf.ctrlpts_size_v)


        data[j + 1, 0] = abs(ops.nodeDisp(nodeToLoad, 2))
        data[j + 1, 1] = ops.getLoadFactor(1)

        print("data[j+1,0]: ", data[j + 1, 0])
        print("2*data[j+1,1]: ", 2*data[j + 1, 1])


        print("\nNext load step\n")

P = Pz / 1000 * np.array([0, 0.05, 0.1, 0.125, 0.15, 0.175, 0.20, 0.225, 0.25, 0.275, 0.3, 0.325, 0.35, 0.40, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9, 0.95, 1])

wA = 1.0 / 100 * np.array([0, 5.421, 16.1, 22.195, 27.657, 32.7, 37.582, 42.633, 48.537, 56.355, 66.41, 79.81, 94.669, 113.704,
                           124.751, 132.653, 138.92, 144.185, 148.77, 152.863, 156.584, 160.015, 163.211, 166.2, 168.973, 171.505])


plt.plot(data[:, 0], 2*data[:, 1], 'or')
plt.plot(wA, P, '-r')
plt.xlabel('Downward deflection at point A x100')
plt.ylabel('Load at point A x1000')
plt.show()

# Visualize surface
# surfVisualize(surf, hold=True)

# print("Done")

# elasticSolution = (Pz * (La**3)) / (3 * E1 * I)

# print("elasticSolution: ", elasticSolution)
# print("data[nSteps,0]: ", data[nSteps, 0])


# # Visualizing deformed surface
# container.sample_size = 60
# for surf in container:
#     surf.evaluate()
    
# # Visualization configuration
# container.vis = VisVTK.VisSurface(ctrlpts=True, legend=False)

# # Render the surface
# evalcolor = ["green", "green", 'black']
# cpcolor=["green","green","black"]
# container.render(evalcolor=evalcolor, cpcolor=cpcolor, plot=True)

print("Finished analysis")
print("data[:,0]: ", data[:,0])
print("data[:,1]*2: ", data[:,1]*2)
