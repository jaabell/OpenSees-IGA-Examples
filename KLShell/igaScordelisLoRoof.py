
#  IGA Scordelis Lo Roof
import numpy as np
import opensees as ops
from math import *

# Geomgl utilities for visualization and surface manipulation
from geomdl import NURBS, compatibility, operations, knotvector
from surfVisualize import *

mm = 1.0 / 1000.  # m

ops.wipe()
ops.model('basic', '-ndm', 3, '-ndf', 3)

# R=25
# L=50
# phi=40
# deg2rad = pi / 180

# controlPts=np.zeros((4,3,3))

# # First zKnot

# x1=np.sqrt(R**2+R**2*np.tan(deg2rad*20)**2)

# point0=[R*np.cos(deg2rad*(90-phi)), R*np.sin(deg2rad*(90-phi)), 0, 1]
# point1=[x1*np.cos(deg2rad*(90-phi/2)), x1*np.sin(deg2rad*(90-phi/2)), 0, 1]
# point2=[0,R,0,1]
# point3=[x1*np.cos(deg2rad*(90+phi/2)), x1*np.sin(deg2rad*(90+phi/2)), 0, 1]
# point4=[R*np.cos(deg2rad*(90+phi)), R*np.sin(deg2rad*(90+phi)), 0, 1]


# # Second zKnot
# z=L/2

# # point3=[R*np.cos(deg2rad*(90-phi)), R*np.sin(deg2rad*(90-phi)),z,1]
# # point4=[x1*np.cos(deg2rad*70), x1*np.sin(deg2rad*70), z, 1]
# # point5=[0,R,z,1]

# point5=[R*np.cos(deg2rad*(90-phi)), R*np.sin(deg2rad*(90-phi)), z, 1]
# point6=[x1*np.cos(deg2rad*(90-phi/2)), x1*np.sin(deg2rad*(90-phi/2)), z, 1]
# point7=[0,R,z,1]
# point8=[x1*np.cos(deg2rad*(90+phi/2)), x1*np.sin(deg2rad*(90+phi/2)), z, 1]
# point9=[R*np.cos(deg2rad*(90+phi)), R*np.sin(deg2rad*(90+phi)), z, 1]

# # Third zKnot
# z=L

# # point6=[R*np.cos(deg2rad*(90-phi)), R*np.sin(deg2rad*(90-phi)),z,1]
# # point7=[x1*np.cos(deg2rad*70), x1*np.sin(deg2rad*70), z, 1]
# # point8=[0,R,z,1]

# point10=[R*np.cos(deg2rad*(90-phi)), R*np.sin(deg2rad*(90-phi)), z, 1]
# point11=[x1*np.cos(deg2rad*(90-phi/2)), x1*np.sin(deg2rad*(90-phi/2)), z, 1]
# point12=[0,R,z,1]
# point13=[x1*np.cos(deg2rad*(90+phi/2)), x1*np.sin(deg2rad*(90+phi/2)), z, 1]
# point14=[R*np.cos(deg2rad*(90+phi)), R*np.sin(deg2rad*(90+phi)), z, 1]

# # Weights
# fac=np.cos(deg2rad*(phi/2))
# point1[3]=fac
# point2[3]=fac
# point3[3]=fac

# point6[3]=fac
# point7[3]=fac
# point8[3]=fac

# point11[3]=fac
# point12[3]=fac
# point13[3]=fac

# controlPts=[point0,point1,point2,point3,point4,point5,point6,point7,point8,point9,point10,point11,point12,point13,point14]


# These are given in v,u and weighted (x*w,y*w,z*w,w)
controlPts = np.array([
[16.06969024216349, 19.15111107797445, 0.0, 1.0], 
[16.06969024216349, 19.15111107797445, 0.5208333333333333, 1.0], 
[16.06969024216349, 19.15111107797445, 1.5625, 1.0], 
[16.06969024216349, 19.15111107797445, 3.125, 1.0], 
[16.06969024216349, 19.15111107797445, 4.6875, 1.0], 
[16.06969024216349, 19.15111107797445, 6.25, 1.0], 
[16.06969024216349, 19.15111107797445, 7.812499999999999, 1.0], 
[16.06969024216349, 19.15111107797445, 9.375, 1.0], 
[16.06969024216349, 19.15111107797445, 10.9375, 1.0], 
[16.06969024216349, 19.15111107797445, 12.5, 1.0], 
[16.06969024216349, 19.15111107797445, 14.0625, 1.0], 
[16.06969024216349, 19.15111107797445, 15.625, 1.0], 
[16.06969024216349, 19.15111107797445, 17.1875, 1.0], 
[16.06969024216349, 19.15111107797445, 18.75, 1.0], 
[16.06969024216349, 19.15111107797445, 20.3125, 1.0], 
[16.06969024216349, 19.15111107797445, 21.875, 1.0], 
[16.06969024216349, 19.15111107797445, 23.4375, 1.0], 
[16.06969024216349, 19.15111107797445, 24.47916666666666, 1.0], 
[16.06969024216349, 19.15111107797445, 25.0, 1.0], 
[15.79608331414272, 19.38069455036423, 0.0, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 0.5208333333333333, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 1.5625, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 3.125, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 4.6875, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 6.25, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 7.812499999999999, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 9.375, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 10.9375, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 12.5, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 14.0625, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 15.625, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 17.1875, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 18.75, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 20.3125, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 21.875, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 23.4375, 0.9974871925327462], 
[15.79608331414272, 19.38069455036422, 24.47916666666666, 0.9974871925327462], 
[15.79608331414272, 19.38069455036423, 25.0, 0.9974871925327462], 
[15.23718450778608, 19.8296383570435, 0.0, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 0.5208333333333333, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 1.5625, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 3.125000000000001, 0.9927756785316452], 
[15.23718450778608, 19.8296383570435, 4.687499999999999, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 6.25, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 7.8125, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 9.374999999999998, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 10.9375, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 12.5, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 14.0625, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 15.625, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 17.1875, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 18.75, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 20.3125, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 21.875, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 23.4375, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 24.47916666666667, 0.9927756785316453], 
[15.23718450778608, 19.8296383570435, 25.0, 0.9927756785316453], 
[14.36691015638432, 20.46907553672591, 0.0, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 0.5208333333333334, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 1.5625, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 3.125000000000001, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 4.687500000000001, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 6.25, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 7.812500000000002, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 9.375000000000002, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 10.9375, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 12.5, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 14.0625, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 15.625, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 17.18750000000001, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 18.75000000000001, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 20.3125, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 21.875, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 23.4375, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 24.47916666666667, 0.986650710330214], 
[14.36691015638432, 20.46907553672591, 25.0, 0.986650710330214], 
[13.4646063499204, 21.07367264114462, 0.0, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 0.5208333333333334, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 1.5625, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 3.125, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 4.687500000000001, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 6.250000000000001, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 7.812500000000001, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 9.375000000000002, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 10.9375, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 12.5, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 14.0625, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 15.625, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 17.18750000000001, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 18.75, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 20.3125, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 21.875, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 23.4375, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 24.47916666666667, 0.9814680449290031], 
[13.4646063499204, 21.07367264114462, 25.0, 0.9814680449290031], 
[12.53237365963464, 21.64112638516749, 0.0, 0.9772276823280122], 
[12.53237365963464, 21.64112638516749, 0.5208333333333334, 0.9772276823280122], 
[12.53237365963464, 21.64112638516749, 1.5625, 0.9772276823280124], 
[12.53237365963463, 21.64112638516749, 3.125, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 4.6875, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 6.250000000000001, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 7.8125, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 9.375, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 10.9375, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 12.5, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 14.0625, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 15.625, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 17.1875, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 18.75, 0.9772276823280124], 
[12.53237365963464, 21.64112638516749, 20.3125, 0.9772276823280124], 
[12.53237365963464, 21.6411263851675, 21.875, 0.9772276823280122], 
[12.53237365963464, 21.64112638516749, 23.4375, 0.9772276823280122], 
[12.53237365963464, 21.64112638516749, 24.47916666666667, 0.9772276823280122], 
[12.53237365963464, 21.64112638516749, 25.0, 0.9772276823280122], 
[11.57252704588192, 22.16930453700196, 0.0, 0.9739296225272416], 
[11.57252704588192, 22.16930453700196, 0.5208333333333334, 0.9739296225272416], 
[11.57252704588192, 22.16930453700196, 1.5625, 0.9739296225272416], 
[11.57252704588192, 22.16930453700196, 3.125, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 4.6875, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 6.250000000000003, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 7.812500000000001, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 9.375, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 10.9375, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 12.50000000000001, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 14.0625, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 15.625, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 17.1875, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 18.75, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 20.3125, 0.9739296225272416], 
[11.57252704588192, 22.16930453700197, 21.875, 0.9739296225272416], 
[11.57252704588192, 22.16930453700196, 23.4375, 0.9739296225272416], 
[11.57252704588192, 22.16930453700196, 24.47916666666667, 0.9739296225272416], 
[11.57252704588192, 22.16930453700196, 25.0, 0.9739296225272416], 
[10.58757808439474, 22.65627033087399, 0.0, 0.9715738655266911], 
[10.58757808439474, 22.65627033087399, 0.5208333333333334, 0.9715738655266911], 
[10.58757808439474, 22.65627033087399, 1.562500000000001, 0.9715738655266911], 
[10.58757808439474, 22.65627033087399, 3.125000000000001, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 4.687500000000001, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 6.250000000000003, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 7.812500000000001, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 9.375, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 10.9375, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 12.50000000000001, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 14.06250000000001, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 15.625, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 17.1875, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 18.75, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 20.3125, 0.9715738655266911], 
[10.58757808439474, 22.656270330874, 21.875, 0.9715738655266911], 
[10.58757808439474, 22.65627033087399, 23.43750000000001, 0.9715738655266911], 
[10.58757808439474, 22.65627033087399, 24.47916666666667, 0.9715738655266911], 
[10.58757808439474, 22.65627033087399, 25.0, 0.9715738655266911], 
[9.580213913680074, 23.1003046009875, 0.0, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 0.5208333333333334, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 1.5625, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 3.125, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 4.6875, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 6.250000000000001, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 7.812500000000002, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 9.375, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 10.9375, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 12.5, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 14.0625, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 15.625, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 17.1875, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 18.75, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 20.3125, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 21.875, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 23.4375, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 24.47916666666667, 0.9701604113263609], 
[9.580213913680074, 23.1003046009875, 25.0, 0.9701604113263609], 
[8.553273255105259, 23.49992513082683, 0.0, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 0.5208333333333336, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 1.562500000000001, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 3.125, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 4.6875, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 6.250000000000001, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 7.812500000000002, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 9.375000000000002, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 10.9375, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 12.5, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 14.0625, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 15.625, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 17.1875, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 18.75, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 20.3125, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 21.875, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 23.43750000000001, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 24.47916666666667, 0.9696892599262508], 
[8.553273255105259, 23.49992513082683, 25.0, 0.9696892599262508], 
[7.509719945033988, 23.85390277580238, 0.0, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 0.5208333333333335, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 1.5625, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 3.125, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 4.687499999999999, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 6.250000000000001, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 7.812500000000002, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 9.375, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 10.9375, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 12.5, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 14.0625, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 15.625, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 17.1875, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 18.75, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 20.3125, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 21.875, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 23.4375, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 24.47916666666667, 0.9701604113263609], 
[7.509719945033988, 23.85390277580238, 25.0, 0.9701604113263609], 
[6.452614492755698, 24.16127399800508, 0.0, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 0.5208333333333335, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 1.562500000000001, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 3.125000000000001, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 4.687500000000002, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 6.250000000000002, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 7.812500000000002, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 9.375000000000004, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 10.93750000000001, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 12.5, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 14.0625, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 15.625, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 17.1875, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 18.75, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 20.3125, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 21.875, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 23.43750000000001, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 24.47916666666667, 0.971573865526691], 
[6.452614492755698, 24.16127399800508, 25.00000000000001, 0.971573865526691], 
[5.385084235410521, 24.42134954623798, 0.0, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 0.5208333333333335, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 1.5625, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 3.125000000000001, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 4.687500000000002, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 6.250000000000002, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 7.812500000000002, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 9.375000000000004, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 10.9375, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 12.5, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 14.0625, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 15.625, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 17.1875, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 18.75, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 20.3125, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 21.875, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 23.4375, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 24.47916666666667, 0.9739296225272415], 
[5.385084235410521, 24.42134954623798, 25.00000000000001, 0.9739296225272415], 
[4.310292698992348, 24.63371911856815, 0.0, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 0.5208333333333334, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 1.5625, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 3.125, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 4.687500000000001, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 6.250000000000003, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 7.812500000000001, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 9.375000000000004, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 10.9375, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 12.5, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 14.0625, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 15.625, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 17.1875, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 18.75, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 20.3125, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 21.875, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 23.43750000000001, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 24.47916666666667, 0.9772276823280122], 
[4.310292698992348, 24.63371911856815, 25.0, 0.9772276823280122], 
[3.23140879117695, 24.79825195389281, 0.0, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 0.5208333333333334, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 1.5625, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 3.125, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 4.6875, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 6.250000000000002, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 7.812500000000002, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 9.375000000000004, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 10.9375, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 12.5, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 14.0625, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 15.625, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 17.1875, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 18.75, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 20.3125, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 21.875, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 23.43750000000001, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 24.47916666666667, 0.981468044929003], 
[3.23140879117695, 24.79825195389281, 25.0, 0.981468044929003], 
[2.151576446657456, 24.91509340869504, 0.0, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 0.5208333333333333, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 1.5625, 0.986650710330214], 
[2.151576446657457, 24.91509340869504, 3.125000000000002, 0.9866507103302138], 
[2.151576446657456, 24.91509340869504, 4.687500000000001, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 6.250000000000002, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 7.812500000000002, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 9.375000000000004, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 10.9375, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 12.5, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 14.0625, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 15.625, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 17.1875, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 18.75, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 20.3125, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 21.875, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 23.4375, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 24.47916666666667, 0.986650710330214], 
[2.151576446657456, 24.91509340869504, 25.00000000000001, 0.986650710330214], 
[1.073885319504399, 24.9846576805847, 0.0, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 0.5208333333333331, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 1.5625, 0.9927756785316453], 
[1.0738853195044, 24.9846576805847, 3.125, 0.9927756785316452], 
[1.073885319504399, 24.9846576805847, 4.6875, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 6.25, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 7.812500000000001, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 9.375, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 10.9375, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 12.5, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 14.0625, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 15.625, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 17.1875, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 18.75, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 20.3125, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 21.875, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 23.4375, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 24.47916666666667, 0.9927756785316453], 
[1.073885319504399, 24.9846576805847, 25.0, 0.9927756785316453], 
[0.3571684782501196, 25.0, 0.0, 0.9974871925327462], 
[0.3571684782501196, 25.0, 0.5208333333333333, 0.9974871925327462], 
[0.3571684782501196, 25.0, 1.5625, 0.9974871925327462], 
[0.3571684782501197, 25.0, 3.125, 0.9974871925327462], 
[0.3571684782501197, 25.0, 4.6875, 0.9974871925327462], 
[0.3571684782501197, 25.0, 6.25, 0.9974871925327462], 
[0.3571684782501197, 25.0, 7.812499999999999, 0.9974871925327462], 
[0.3571684782501197, 25.0, 9.375, 0.9974871925327462], 
[0.3571684782501197, 25.0, 10.9375, 0.9974871925327462], 
[0.3571684782501197, 25.0, 12.5, 0.9974871925327462], 
[0.3571684782501197, 25.0, 14.0625, 0.9974871925327462], 
[0.3571684782501197, 25.0, 15.625, 0.9974871925327462], 
[0.3571684782501197, 25.0, 17.1875, 0.9974871925327462], 
[0.3571684782501197, 25.0, 18.75, 0.9974871925327462], 
[0.3571684782501197, 25.0, 20.3125, 0.9974871925327462], 
[0.3571684782501197, 25.0, 21.875, 0.9974871925327462], 
[0.3571684782501196, 25.0, 23.4375, 0.9974871925327462], 
[0.3571684782501196, 25.0, 24.47916666666666, 0.9974871925327462], 
[0.3571684782501196, 25.0, 25.0, 0.9974871925327462], 
[0.0, 25.0, 0.0, 1.0], 
[0.0, 25.0, 0.5208333333333333, 1.0], 
[0.0, 25.0, 1.5625, 1.0], 
[0.0, 25.0, 3.125, 1.0], 
[0.0, 25.0, 4.6875, 1.0], 
[0.0, 25.0, 6.25, 1.0], 
[0.0, 25.0, 7.812499999999999, 1.0], 
[0.0, 25.0, 9.375, 1.0], 
[0.0, 25.0, 10.9375, 1.0], 
[0.0, 25.0, 12.5, 1.0], 
[0.0, 25.0, 14.0625, 1.0], 
[0.0, 25.0, 15.625, 1.0], 
[0.0, 25.0, 17.1875, 1.0], 
[0.0, 25.0, 18.75, 1.0], 
[0.0, 25.0, 20.3125, 1.0], 
[0.0, 25.0, 21.875, 1.0], 
[0.0, 25.0, 23.4375, 1.0], 
[0.0, 25.0, 24.47916666666666, 1.0], 
[0.0, 25.0, 25.0, 1.0]
])

for point in controlPts: #weighting controlPts
    point[0:3]*=point[3]


patchTag = 1
P = 3
Q = 3


# Create a NURBS surface instance
surf = NURBS.Surface()

# Set surface degrees
surf.degree_u = P
surf.degree_v = Q

# Setting control points for surface
surf.set_ctrlpts(controlPts.tolist(), 19, 19)

# Set knot vectors
surf.knotvector_u = knotvector.generate(surf.degree_u, surf.ctrlpts_size_u)
surf.knotvector_v = knotvector.generate(surf.degree_v, surf.ctrlpts_size_v)

# Visualize surface
surfVisualize(surf, hold=True)
# exit()



# nDMaterial ElasticIsotropic $nDtag_elastic $elasticidad_probeta
# $poisson_probeta
E1 = 4.32e8  # Young's modulus N/m^2
E2 = E1
nu = 0.0  # Poisson's ratio
g = -9.8066  # gravity, m/s^2
t = 0.25
rho = 90/abs(g)/t  # kg/m^3


tagNDmat1 = 1
ops.nDMaterial("ElasticIsotropic", tagNDmat1, E1, nu, rho)

tagNDmat2 = 2
ops.nDMaterial("ElasticIsotropic", tagNDmat2, E2, nu, rho)


# nDMaterial PlateFiber $nDtag_platefiber $nDtag_elastic
tagPlaneStress1 = 3
ops.nDMaterial("PlaneStress", tagPlaneStress1, tagNDmat1)

tagPlaneStress2 = 4
ops.nDMaterial("PlaneStress", tagPlaneStress2, tagNDmat2)

deg2rad = pi / 180

gFact = [0.0, 0.0, 0.0]

matTags = [3]
thickness = [t]
θ = [0 * deg2rad]


Nlayers = len(θ)

controlPts = surf.ctrlpts2d[:]
controlPts = np.array(compatibility.flip_ctrlpts2d(controlPts))

for point in controlPts:
    for i in range(surf.ctrlpts_size_v):
        for k in range(3):
            point[i][k] /= point[i][3]

nodeStartTag=1

ops.IGA("Patch", patchTag, nodeStartTag, surf.degree_u, surf.degree_v, surf.ctrlpts_size_u, surf.ctrlpts_size_v,
        "-type", "KLShell",
        "-nonLinearGeometry", 0,
        "-planeStressMatTags", *matTags,
        "-gFact", *gFact,
        "-theta", *θ,
        "-thickness", *thickness,
        "-uKnot", *surf.knotvector_u, "-vKnot", *surf.knotvector_v, "-controlPts", *controlPts.flatten())


print("\n\n\nPRINTING DOMAIN-----------------------")
ops.printModel()
print("\n\n\nDONE PRINTING DOMAIN-----------------------")


#  Dirichlet BCs (symmetry conditions)
#    z
#    |
#  (D)------- (C)
#    |      |
#    |    L |
#    |  R   |
#  (A)------- (B) --->x
#
#  rigid diaphram: AB: u_x, u_y = 0
#  Symmetry conditions on CD and AD
#  BC is free

nPoints = surf.ctrlpts_size_v * surf.ctrlpts_size_u
nodesOnCB = np.arange(1, nPoints, surf.ctrlpts_size_v)
nodesOnAD = nodesOnCB + surf.ctrlpts_size_v - 1
nodesOnAB = np.arange(1, surf.ctrlpts_size_u + 1)
nodesOnDC = np.arange(nPoints - surf.ctrlpts_size_u + 1, nPoints + 1)

nodesNextToAB = nodesOnAB + surf.ctrlpts_size_u
nodesNextToAD = nodesOnAD - 1

recordNode = 1 # Measure deformation here


for n in ops.getNodeTags():
    n = int(n)
    if n in nodesOnAB:
        ops.fix(n, 0, 0, 1)
    elif n in nodesOnAD:
        ops.fix(n, 1, 0, 0)
    elif n in nodesOnDC:
        ops.fix(n, 1, 1, 0)

# Symmetry conditions
for i in range(len(nodesOnDC)):
    # ops.equalDOF(int(nodesOnDC[i]), int(nodesNextToDC[i]), 1, 2, 3)
    # ops.equalDOF(int(nodesOnAD[i]), int(nodesNextToAD[i]), 1, 2, 3)

    ops.equalDOF(int(nodesOnAB[i]), int(nodesNextToAB[i]), 2)
    ops.equalDOF(int(nodesOnAD[i]), int(nodesNextToAD[i]), 2)


# ------------------------------
# Start of analysis generation
# ------------------------------

# create TimeSeries
ops.timeSeries("Linear", 1)

# create a plain load pattern
ops.pattern("Plain", 1, 1)


print("Loading nodes")
weight = [0.0, g, 0.0]
ops.eleLoad("-ele", 1, "-type", "-SelfWeight", *weight)
print("Finished loading nodes")


# create SOE
# ops.system("FullGeneral")
ops.system("UmfPack")

# ops.system("BandSPD")

# create DOF number
ops.numberer("Plain")


print("Starting analysis")

# create constraint handler
ops.constraints("Plain")
# ops.constraints("Penalty", 1e12*E1,1e12*E1)

# Create test
ops.test("NormDispIncr", 1.0e-9, 50, 1)
# ops.test("NormUnbalance",1e-8,10)

# create algorithm

ops.algorithm("Linear")
# ops.algorithm("Newton")
# ops.algorithm("ModifiedNewton")
# ops.algorithm("KrylovNewton")

# create integrator
# nSteps=10
# ops.integrator("LoadControl", 1.0/nSteps)
ops.integrator("LoadControl", 1.0)


# create analysis object
ops.analysis("Static")

ops.analyze(1)

print("Finished analysis")

# Adding deformation to controlPts
controlPts = surf.ctrlpts2d[:]
controlPts = compatibility.flip_ctrlpts2d(controlPts)  # Flipping to u,v

fDefX = 1e1
fDefY = 1e1
fDefZ = 1e1
i = 1
for dim in controlPts:
    for point in dim:
        weight=point[3]

        point[0]/=weight
        point[1]/=weight
        point[2]/=weight

        point[0] = (ops.nodeCoord(i,1)+fDefX * ops.nodeDisp(i,1)) * weight  # Times the weight
        point[1] = (ops.nodeCoord(i,2)+fDefY * ops.nodeDisp(i,2)) * weight  # Times the weight
        point[2] = (ops.nodeCoord(i,3)+fDefZ * ops.nodeDisp(i,3)) * weight  # Times the weight

        i += 1

# Setting control points for surface
controlPts = compatibility.flip_ctrlpts2d(controlPts)
controlPts = (np.array(controlPts).reshape(
    nPoints, 4))
surf.set_ctrlpts(controlPts.tolist(), surf.ctrlpts_size_u, surf.ctrlpts_size_v)

# Visualize surface
surfVisualize(surf, hold=True)

dispC=ops.nodeDisp(recordNode)
print("dispC: ", dispC)


print("Done")
