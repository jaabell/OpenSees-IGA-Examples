#  IGA Pinched Cylinder, almost working. Had to do a weird thing with the symmetry conditions
import numpy as np
import opensees as ops
from math import *

# Geomgl utilities for visualization and surface manipulation
from geomdl import NURBS, compatibility, operations, knotvector
from surfVisualize import *

mm = 1.0 / 1000.  # m

ops.wipe()
ops.model('basic', '-ndm', 3, '-ndf', 3)

controlPts = np.array([

[300.0             , 0.0               , 0.0               , 1.0]                ,
[300.0             , 0.0               , 6.25              , 1.0]                ,
[300.0             , 0.0               , 18.75             , 1.0]                ,
[300.0             , 0.0               , 37.5              , 1.0]                ,
[300.0             , 0.0               , 56.25             , 1.0]                ,
[300.0             , 0.0               , 75.0              , 1.0]                ,
[300.0             , 0.0               , 93.75             , 1.0]                ,
[300.0             , 0.0               , 112.5             , 1.0]                ,
[300.0             , 0.0               , 131.25            , 1.0]                ,
[300.0             , 0.0               , 150.0             , 1.0]                ,
[300.0             , 0.0               , 168.75            , 1.0]                ,
[300.0             , 0.0               , 187.5             , 1.0]                ,
[300.0             , 0.0               , 206.25            , 1.0]                ,
[300.0             , 0.0               , 225.0             , 1.0]                ,
[300.0             , 0.0               , 243.75            , 1.0]                ,
[300.0             , 0.0               , 262.5             , 1.0]                ,
[300.0             , 0.0               , 281.25            , 1.0]                ,
[300.0             , 0.0               , 293.75            , 1.0]                ,
[300.0             , 0.0               , 300.0             , 1.0]                ,
[299.9999999999999 , 5.342419822349625 , 0.0               , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 6.25              , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 18.75             , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 37.49999999999999 , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 56.24999999999999 , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 74.99999999999999 , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 93.74999999999999 , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 112.5             , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 131.25            , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349624 , 150.0             , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 168.75            , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 187.5             , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 206.25            , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 225.0             , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 243.75            , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 262.5             , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 281.2499999999999 , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 293.75            , 0.9926776695296637] ,
[299.9999999999999 , 5.342419822349625 , 299.9999999999999 , 0.9926776695296637] ,
[299.7604729294209 , 16.16042136370052 , 0.0               , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 6.25              , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 18.75             , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370051 , 37.5              , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 56.25             , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 75.0              , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 93.74999999999999 , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 112.5             , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370051 , 131.25            , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370051 , 150.0             , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370051 , 168.75            , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 187.5             , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 206.25            , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 225.0             , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 243.75            , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 262.4999999999999 , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 281.25            , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 293.75            , 0.9784906542433871] ,
[299.7604729294209 , 16.16042136370052 , 300.0             , 0.9784906542433871] ,
[298.655241738917  , 32.63760754649822 , 0.0               , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 6.25              , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 18.75             , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 37.5              , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 56.24999999999999 , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 75.0              , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 93.74999999999999 , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 112.5             , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 131.25            , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 150.0             , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 168.75            , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 187.5             , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 206.25            , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 225.0             , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 243.75            , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 262.4999999999999 , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 281.2499999999999 , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 293.75            , 0.9585830682771603] ,
[298.655241738917  , 32.63760754649822 , 300.0             , 0.9585830682771603] ,
[295.6122955210199 , 54.91536410268687 , 0.0               , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 6.25              , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 18.75             , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 37.5              , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 56.25             , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 75.0              , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 93.75             , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 112.5             , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 131.25            , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 150.0             , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 168.75            , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 187.5             , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 206.25            , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 225.0             , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 243.75            , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 262.5             , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 281.25            , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 293.75            , 0.9347854942485673] ,
[295.6122955210199 , 54.91536410268687 , 300.0             , 0.9347854942485673] ,
[289.0492816374507 , 82.91811246005346 , 0.0               , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 6.25              , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005348 , 18.75             , 0.9096149832567861] ,
[289.0492816374507 , 82.91811246005348 , 37.5              , 0.9096149832567861] ,
[289.0492816374507 , 82.91811246005348 , 56.25             , 0.9096149832567861] ,
[289.0492816374507 , 82.91811246005348 , 75.0              , 0.9096149832567861] ,
[289.0492816374507 , 82.91811246005348 , 93.75000000000001 , 0.9096149832567861] ,
[289.0492816374507 , 82.91811246005348 , 112.5             , 0.9096149832567861] ,
[289.0492816374507 , 82.91811246005348 , 131.25            , 0.9096149832567861] ,
[289.0492816374507 , 82.91811246005346 , 150.0             , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 168.75            , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 187.5             , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 206.2499999999999 , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 225.0             , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 243.75            , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 262.4999999999999 , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 281.25            , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 293.7499999999999 , 0.9096149832567862] ,
[289.0492816374507 , 82.91811246005346 , 299.9999999999999 , 0.9096149832567862] ,
[279.5684646880758 , 110.8435279186375 , 0.0               , 0.8890209288089653] ,
[279.5684646880758 , 110.8435279186375 , 6.249999999999999 , 0.8890209288089653] ,
[279.5684646880759 , 110.8435279186375 , 18.75000000000001 , 0.8890209288089652] ,
[279.5684646880759 , 110.8435279186375 , 37.50000000000001 , 0.8890209288089652] ,
[279.5684646880759 , 110.8435279186375 , 56.25             , 0.8890209288089652] ,
[279.5684646880759 , 110.8435279186375 , 75.00000000000001 , 0.8890209288089652] ,
[279.5684646880759 , 110.8435279186375 , 93.74999999999999 , 0.8890209288089652] ,
[279.5684646880759 , 110.8435279186375 , 112.5             , 0.8890209288089652] ,
[279.5684646880759 , 110.8435279186375 , 131.25            , 0.8890209288089652] ,
[279.5684646880759 , 110.8435279186375 , 150.0             , 0.8890209288089652] ,
[279.5684646880758 , 110.8435279186375 , 168.75            , 0.8890209288089653] ,
[279.5684646880758 , 110.8435279186375 , 187.4999999999999 , 0.8890209288089654] ,
[279.5684646880758 , 110.8435279186375 , 206.2499999999999 , 0.8890209288089654] ,
[279.5684646880758 , 110.8435279186375 , 224.9999999999999 , 0.8890209288089654] ,
[279.5684646880758 , 110.8435279186375 , 243.7499999999999 , 0.8890209288089654] ,
[279.5684646880758 , 110.8435279186375 , 262.5             , 0.8890209288089653] ,
[279.5684646880758 , 110.8435279186375 , 281.2499999999999 , 0.8890209288089653] ,
[279.5684646880758 , 110.8435279186375 , 293.75            , 0.8890209288089653] ,
[279.5684646880758 , 110.8435279186375 , 299.9999999999999 , 0.8890209288089653] ,
[267.1124536601329 , 138.2469659610616 , 0.0               , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 6.25              , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 18.75000000000001 , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 37.50000000000001 , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 56.25000000000001 , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 75.00000000000001 , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 93.75             , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 112.5             , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 131.25            , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 150.0             , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 168.75            , 0.8730033309051046] ,
[267.1124536601328 , 138.2469659610616 , 187.4999999999999 , 0.8730033309051048] ,
[267.1124536601328 , 138.2469659610616 , 206.2499999999999 , 0.8730033309051048] ,
[267.1124536601328 , 138.2469659610616 , 225.0             , 0.8730033309051048] ,
[267.1124536601328 , 138.2469659610616 , 243.7499999999999 , 0.8730033309051048] ,
[267.1124536601329 , 138.2469659610616 , 262.5             , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 281.2499999999999 , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 293.7500000000001 , 0.8730033309051046] ,
[267.1124536601329 , 138.2469659610616 , 299.9999999999999 , 0.8730033309051046] ,
[251.7138019694662 , 164.6626280552645 , 0.0               , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 6.249999999999997 , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 18.75             , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 37.5              , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 56.24999999999999 , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 75.0              , 0.8615621895452041] ,
[251.7138019694662 , 164.6626280552645 , 93.75000000000001 , 0.8615621895452041] ,
[251.7138019694662 , 164.6626280552645 , 112.5             , 0.8615621895452041] ,
[251.7138019694662 , 164.6626280552645 , 131.2499999999999 , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 150.0             , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 168.7499999999999 , 0.8615621895452044] ,
[251.7138019694661 , 164.6626280552644 , 187.4999999999999 , 0.8615621895452045] ,
[251.7138019694661 , 164.6626280552644 , 206.2499999999999 , 0.8615621895452045] ,
[251.7138019694661 , 164.6626280552644 , 224.9999999999999 , 0.8615621895452045] ,
[251.7138019694661 , 164.6626280552644 , 243.7499999999999 , 0.8615621895452045] ,
[251.7138019694662 , 164.6626280552645 , 262.4999999999999 , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 281.2499999999999 , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 293.7499999999999 , 0.8615621895452044] ,
[251.7138019694662 , 164.6626280552645 , 299.9999999999999 , 0.8615621895452044] ,
[233.5016924870939 , 189.6265205198158 , 0.0               , 0.8546975047292641] ,
[233.5016924870939 , 189.6265205198158 , 6.249999999999997 , 0.8546975047292641] ,
[233.5016924870939 , 189.6265205198158 , 18.75             , 0.8546975047292642] ,
[233.5016924870939 , 189.6265205198158 , 37.5              , 0.8546975047292641] ,
[233.5016924870939 , 189.6265205198158 , 56.24999999999999 , 0.8546975047292641] ,
[233.501692487094  , 189.6265205198158 , 75.0              , 0.8546975047292639] ,
[233.501692487094  , 189.6265205198158 , 93.75             , 0.8546975047292639] ,
[233.501692487094  , 189.6265205198158 , 112.5             , 0.854697504729264]  ,
[233.5016924870939 , 189.6265205198158 , 131.25            , 0.8546975047292641] ,
[233.5016924870939 , 189.6265205198158 , 149.9999999999999 , 0.8546975047292642] ,
[233.5016924870939 , 189.6265205198158 , 168.7499999999999 , 0.8546975047292642] ,
[233.5016924870939 , 189.6265205198158 , 187.4999999999999 , 0.8546975047292642] ,
[233.5016924870939 , 189.6265205198158 , 206.2499999999999 , 0.8546975047292642] ,
[233.5016924870939 , 189.6265205198158 , 224.9999999999999 , 0.8546975047292642] ,
[233.5016924870939 , 189.6265205198158 , 243.7499999999999 , 0.8546975047292642] ,
[233.5016924870939 , 189.6265205198158 , 262.4999999999999 , 0.8546975047292642] ,
[233.5016924870939 , 189.6265205198158 , 281.2499999999999 , 0.8546975047292641] ,
[233.5016924870939 , 189.6265205198158 , 293.7499999999999 , 0.8546975047292641] ,
[233.5016924870939 , 189.6265205198158 , 299.9999999999999 , 0.8546975047292641] ,
[212.7014867678659 , 212.7014867678659 , 0.0               , 0.8524092764572839] ,
[212.7014867678659 , 212.7014867678659 , 6.249999999999998 , 0.8524092764572839] ,
[212.7014867678658 , 212.7014867678658 , 18.74999999999999 , 0.8524092764572841] ,
[212.7014867678659 , 212.7014867678659 , 37.49999999999999 , 0.8524092764572839] ,
[212.7014867678659 , 212.7014867678659 , 56.25             , 0.8524092764572838] ,
[212.701486767866  , 212.701486767866  , 75.00000000000001 , 0.8524092764572837] ,
[212.701486767866  , 212.701486767866  , 93.75000000000001 , 0.8524092764572837] ,
[212.7014867678659 , 212.7014867678659 , 112.5             , 0.8524092764572839] ,
[212.7014867678659 , 212.7014867678659 , 131.25            , 0.8524092764572839] ,
[212.7014867678658 , 212.7014867678658 , 149.9999999999999 , 0.8524092764572841] ,
[212.7014867678658 , 212.7014867678658 , 168.7499999999999 , 0.8524092764572841] ,
[212.7014867678658 , 212.7014867678658 , 187.4999999999999 , 0.8524092764572841] ,
[212.7014867678658 , 212.7014867678658 , 206.2499999999999 , 0.8524092764572841] ,
[212.7014867678658 , 212.7014867678658 , 224.9999999999999 , 0.8524092764572841] ,
[212.7014867678658 , 212.7014867678658 , 243.7499999999999 , 0.8524092764572841] ,
[212.7014867678658 , 212.7014867678658 , 262.4999999999999 , 0.8524092764572841] ,
[212.7014867678659 , 212.7014867678659 , 281.2499999999999 , 0.8524092764572839] ,
[212.7014867678659 , 212.7014867678659 , 293.7499999999999 , 0.8524092764572839] ,
[212.7014867678659 , 212.7014867678659 , 299.9999999999999 , 0.8524092764572839] ,
[189.6265205198158 , 233.501692487094  , 0.0               , 0.854697504729264]  ,
[189.6265205198158 , 233.501692487094  , 6.25              , 0.854697504729264]  ,
[189.6265205198158 , 233.5016924870939 , 18.74999999999999 , 0.8546975047292642] ,
[189.6265205198158 , 233.501692487094  , 37.49999999999999 , 0.854697504729264]  ,
[189.6265205198158 , 233.501692487094  , 56.25000000000001 , 0.8546975047292639] ,
[189.6265205198158 , 233.501692487094  , 75.00000000000001 , 0.8546975047292639] ,
[189.6265205198159 , 233.501692487094  , 93.75000000000003 , 0.8546975047292638] ,
[189.6265205198158 , 233.501692487094  , 112.5             , 0.854697504729264]  ,
[189.6265205198158 , 233.5016924870939 , 131.2499999999999 , 0.8546975047292642] ,
[189.6265205198158 , 233.5016924870939 , 149.9999999999999 , 0.8546975047292642] ,
[189.6265205198158 , 233.5016924870939 , 168.7499999999999 , 0.8546975047292642] ,
[189.6265205198158 , 233.5016924870939 , 187.5             , 0.8546975047292642] ,
[189.6265205198158 , 233.5016924870939 , 206.2499999999999 , 0.8546975047292642] ,
[189.6265205198158 , 233.5016924870939 , 224.9999999999999 , 0.8546975047292642] ,
[189.6265205198158 , 233.5016924870939 , 243.7499999999999 , 0.8546975047292642] ,
[189.6265205198158 , 233.5016924870939 , 262.4999999999999 , 0.8546975047292642] ,
[189.6265205198158 , 233.501692487094  , 281.2499999999999 , 0.854697504729264]  ,
[189.6265205198158 , 233.501692487094  , 293.7499999999999 , 0.854697504729264]  ,
[189.6265205198158 , 233.501692487094  , 299.9999999999999 , 0.854697504729264]  ,
[164.6626280552644 , 251.7138019694662 , 0.0               , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 6.249999999999998 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 18.75             , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 37.49999999999999 , 0.8615621895452044] ,
[164.6626280552645 , 251.7138019694662 , 56.24999999999999 , 0.8615621895452042] ,
[164.6626280552645 , 251.7138019694662 , 75.00000000000001 , 0.8615621895452042] ,
[164.6626280552645 , 251.7138019694662 , 93.74999999999999 , 0.8615621895452042] ,
[164.6626280552644 , 251.7138019694662 , 112.5             , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 131.2499999999999 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 149.9999999999999 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 168.7499999999999 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 187.5             , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 206.25            , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 224.9999999999999 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 243.7499999999999 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 262.4999999999999 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 281.2499999999999 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 293.7499999999999 , 0.8615621895452044] ,
[164.6626280552644 , 251.7138019694662 , 299.9999999999999 , 0.8615621895452044] ,
[138.2469659610616 , 267.1124536601329 , 0.0               , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 6.249999999999999 , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601328 , 18.75             , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 37.5              , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 56.24999999999999 , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 75.0              , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 93.75             , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 112.5             , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 131.25            , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 150.0             , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 168.75            , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 187.5             , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 206.25            , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 225.0             , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 243.75            , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 262.4999999999999 , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 281.2499999999999 , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 293.7499999999999 , 0.8730033309051047] ,
[138.2469659610616 , 267.1124536601329 , 300.0             , 0.8730033309051047] ,
[110.8435279186375 , 279.5684646880758 , 0.0               , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 6.249999999999999 , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 18.75             , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 37.49999999999999 , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 56.25000000000001 , 0.8890209288089652] ,
[110.8435279186375 , 279.5684646880758 , 75.00000000000001 , 0.8890209288089652] ,
[110.8435279186375 , 279.5684646880758 , 93.75000000000003 , 0.8890209288089652] ,
[110.8435279186375 , 279.5684646880758 , 112.5             , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 131.25            , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 149.9999999999999 , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 168.75            , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 187.5             , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 206.25            , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 225.0             , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 243.7499999999999 , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 262.5             , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 281.2499999999999 , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 293.7499999999999 , 0.8890209288089654] ,
[110.8435279186375 , 279.5684646880758 , 299.9999999999999 , 0.8890209288089654] ,
[82.91811246005348 , 289.0492816374509 , 0.0               , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 6.249999999999999 , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 18.75             , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 37.50000000000001 , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 56.25000000000001 , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 75.00000000000001 , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 93.75000000000003 , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 112.5             , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 131.25            , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 150.0             , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 168.75            , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 187.5000000000001 , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 206.25            , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 225.0             , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 243.75            , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 262.5             , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 281.25            , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 293.7500000000001 , 0.9096149832567861] ,
[82.91811246005348 , 289.0492816374509 , 300.0000000000001 , 0.9096149832567861] ,
[54.91536410268687 , 295.61229552102   , 0.0               , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 6.249999999999999 , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 18.75             , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 37.50000000000001 , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 56.25000000000001 , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 75.00000000000001 , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 93.75000000000001 , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 112.5             , 0.9347854942485673] ,
[54.91536410268686 , 295.61229552102   , 131.25            , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 150.0             , 0.9347854942485673] ,
[54.91536410268686 , 295.61229552102   , 168.75            , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 187.5             , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 206.25            , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 225.0             , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 243.75            , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 262.4999999999999 , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 281.25            , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 293.75            , 0.9347854942485673] ,
[54.91536410268687 , 295.61229552102   , 300.0000000000001 , 0.9347854942485673] ,
[32.63760754649822 , 298.655241738917  , 0.0               , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 6.25              , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 18.75             , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 37.5              , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 56.25             , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 74.99999999999999 , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 93.74999999999999 , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 112.5             , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 131.25            , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 150.0             , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 168.75            , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 187.5             , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 206.25            , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 224.9999999999999 , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 243.75            , 0.9585830682771603] ,
[32.63760754649823 , 298.655241738917  , 262.4999999999999 , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 281.25            , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 293.75            , 0.9585830682771603] ,
[32.63760754649822 , 298.655241738917  , 299.9999999999999 , 0.9585830682771603] ,
[16.16042136370051 , 299.7604729294208 , 0.0               , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 6.25              , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 18.75             , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 37.50000000000001 , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 56.25             , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 74.99999999999999 , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 93.74999999999999 , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 112.5             , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 131.25            , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 150.0             , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 168.75            , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 187.5             , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 206.25            , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 225.0             , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 243.75            , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 262.4999999999999 , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 281.25            , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 293.75            , 0.9784906542433871] ,
[16.16042136370051 , 299.7604729294208 , 299.9999999999999 , 0.9784906542433871] ,
[5.342419822349625 , 299.9999999999999 , 0.0               , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 6.25              , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 18.75             , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 37.49999999999999 , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 56.24999999999999 , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 74.99999999999999 , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 93.74999999999999 , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 112.5             , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 131.25            , 0.9926776695296637] ,
[5.342419822349624 , 299.9999999999999 , 150.0             , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 168.75            , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 187.5             , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 206.25            , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 225.0             , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 243.75            , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 262.5             , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 281.2499999999999 , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 293.75            , 0.9926776695296637] ,
[5.342419822349625 , 299.9999999999999 , 299.9999999999999 , 0.9926776695296637] ,
[0.0               , 300.0             , 0.0               , 1.0]                ,
[0.0               , 300.0             , 6.25              , 1.0]                ,
[0.0               , 300.0             , 18.75             , 1.0]                ,
[0.0               , 300.0             , 37.5              , 1.0]                ,
[0.0               , 300.0             , 56.25             , 1.0]                ,
[0.0               , 300.0             , 75.0              , 1.0]                ,
[0.0               , 300.0             , 93.75             , 1.0]                ,
[0.0               , 300.0             , 112.5             , 1.0]                ,
[0.0               , 300.0             , 131.25            , 1.0]                ,
[0.0               , 300.0             , 150.0             , 1.0]                ,
[0.0               , 300.0             , 168.75            , 1.0]                ,
[0.0               , 300.0             , 187.5             , 1.0]                ,
[0.0               , 300.0             , 206.25            , 1.0]                ,
[0.0               , 300.0             , 225.0             , 1.0]                ,
[0.0               , 300.0             , 243.75            , 1.0]                ,
[0.0               , 300.0             , 262.5             , 1.0]                ,
[0.0               , 300.0             , 281.25            , 1.0]                ,
[0.0               , 300.0             , 293.75            , 1.0]                ,
[0.0               , 300.0             , 300.0             , 1.0]
])



for point in controlPts: #weighting controlPts
    point[0:3]*=point[3]




patchTag = 1
P = 5 
Q = 3 


# Create a NURBS surface instance
surf = NURBS.Surface()

# Set surface degrees
surf.degree_u = P
surf.degree_v = Q

# Setting control points for surface
surf.set_ctrlpts(controlPts.tolist(), 21, 19)

# Set knot vectors
surf.knotvector_u = knotvector.generate(surf.degree_u, surf.ctrlpts_size_u)
surf.knotvector_v = knotvector.generate(surf.degree_v, surf.ctrlpts_size_v)

# Visualize surface
surfVisualize(surf, hold=True)




# nDMaterial ElasticIsotropic $nDtag_elastic $elasticidad_probeta
# $poisson_probeta
E1 = 3e6  # Young's modulus N/m^2
E2 = E1
nu = 0.3  # Poisson's ratio
t = 3.0
rho = 0.01  # kg/m^3


tagNDmat1 = 1
ops.nDMaterial("ElasticIsotropic", tagNDmat1, E1, nu, rho)

tagNDmat2 = 2
ops.nDMaterial("ElasticIsotropic", tagNDmat2, E2, nu, rho)


# nDMaterial PlateFiber $nDtag_platefiber $nDtag_elastic
tagPlaneStress1 = 3
ops.nDMaterial("PlaneStress", tagPlaneStress1, tagNDmat1)

tagPlaneStress2 = 4
ops.nDMaterial("PlaneStress", tagPlaneStress2, tagNDmat2)

deg2rad = pi / 180

gFact = [0.0, 0.0, 0.0]

matTags = [3]
thickness = [t]
θ = [0 * deg2rad]


Nlayers = len(θ)

controlPts = surf.ctrlpts2d[:]
controlPts = np.array(compatibility.flip_ctrlpts2d(controlPts))

for dim in controlPts: # Unweighting control pts
    for point in dim:
        point[0:3]/=point[3]



ops.IGA("Patch", patchTag, surf.degree_u, surf.degree_v, surf.ctrlpts_size_u, surf.ctrlpts_size_v,
        "-type", "KLShell",
        "-nonLinearGeometry", 0,
        "-planeStressMatTags", *matTags,
        "-gFact", *gFact,
        "-theta", *θ,
        "-thickness", *thickness,
        "-uKnot", *surf.knotvector_u, "-vKnot", *surf.knotvector_v, "-controlPts", *controlPts.flatten())


print("\n\n\nPRINTING DOMAIN-----------------------")
ops.printModel()
print("\n\n\nDONE PRINTING DOMAIN-----------------------")


# create constraint handler
ops.constraints("Plain")
# ops.constraints("Transformation")
# ops.constraints("Lagrange")
# ops.constraints("Penalty", 1e20, 1e20)

# Dirichlet BCs (symmetry conditions)
#   z
#   |
# (A)------- (B)
#   |      |
#   |    L |
#   |  R   |
# (D)------- (C) --->x

#
# rigid diaphragm: AB: u_x, u_y = 0
# Symmetry conditions on BC,CD and AD
#

nPoints = surf.ctrlpts_size_v * surf.ctrlpts_size_u
nodesOnCB = np.arange(1, nPoints, surf.ctrlpts_size_u)
nodesOnAD = np.arange(surf.ctrlpts_size_u, nPoints + 1, surf.ctrlpts_size_u)
nodesOnAB = np.arange(1, surf.ctrlpts_size_u + 1)
nodesOnDC = np.arange(nPoints - surf.ctrlpts_size_u + 1, nPoints + 1)

nodesNextToAD = nodesOnAD - 1
nodesNextToDC = nodesOnDC - surf.ctrlpts_size_u
nodesNextToCB = nodesOnCB + 1
nodesNextToAB=nodesOnAB+surf.ctrlpts_size_u



forcedNode = nPoints  # Measure deformation here
xConsNodes=np.unique(np.concatenate([nodesOnAB,nodesOnAD]))
yConsNodes=np.unique(np.concatenate([nodesOnAB,nodesOnCB]))
zConsNodes=np.unique(np.concatenate([nodesOnDC]))



# Symmetry conditions
for i in range(len(nodesOnDC)):
    ops.equalDOF(int(nodesOnDC[i]), int(nodesNextToDC[i]), 1,2,3) 
    # ops.equalDOF(int(nodesOnDC[i]), int(nodesNextToDC[i]), 1,3) 
    # ops.equalDOF(int(nodesNextToDC[i]), int(nodesOnDC[i]), 1,2,3) # restrinjo rot 

for i in range(len(nodesOnCB)):
    ops.equalDOF(int(nodesNextToCB[i]), int(nodesOnCB[i]), 2,3) # restrinjo rotZ tomando Y y rotX tomando Z
    # ops.equalDOF(int(nodesOnCB[i]), int(nodesNextToCB[i]), 2,3)
    # ops.equalDOF(int(nodesOnCB[i]), int(nodesNextToCB[i]), 1,3)

for i in range(len(nodesOnAD)):
    ops.equalDOF(int(nodesNextToAD[i]), int(nodesOnAD[i]), 2,3) # restrinjo rotY tomando Z y rotZ tomando Y 
    # ops.equalDOF(int(nodesOnAD[i]), int(nodesNextToAD[i]), 2,3)

for n in ops.getNodeTags():
    n = int(n)
    if n in xConsNodes:
        # ops.fixX(n)
        ops.fix(n,1,0,0)
    if n in yConsNodes:
        # ops.fixY(n)
        ops.fix(n,0,1,0)
    if n in zConsNodes:
        # ops.fixZ(n)
        ops.fix(n,0,0,1)




# ------------------------------
# Start of analysis generation
# ------------------------------

# create TimeSeries
ops.timeSeries("Linear", 1)

# create a plain load pattern
ops.pattern("Plain", 1, 1)


print("Loading nodes")

F = -1.0 / 4.0 
ops.load(forcedNode, 0, F, 0)

print("Finished loading nodes")


# create SOE
# ops.system("FullGeneral")
ops.system("UmfPack")

# ops.system("BandSPD")

# create DOF number
ops.numberer("Plain")


print("Starting analysis")


# Create test
# ops.test("NormDispIncr", 1.0e-9, 50, 1)
ops.test("NormUnbalance",1e-8,10)

# create algorithm

ops.algorithm("Linear")
# ops.algorithm("Newton")
# ops.algorithm("ModifiedNewton")
# ops.algorithm("KrylovNewton")

# create integrator
# nSteps=10
# ops.integrator("LoadControl", 1.0/nSteps)
ops.integrator("LoadControl", 1.0)


# create analysis object
ops.analysis("Static")

ops.analyze(1)

print("Finished analysis")

# Adding deformation to controlPts
controlPts = surf.ctrlpts2d[:]
controlPts = compatibility.flip_ctrlpts2d(controlPts)  # Flipping to u,v

fDefX = 1e0
fDefY = 3e6
fDefZ = 1e0
i = 1
for dim in controlPts:
    for point in dim:
        weight=point[3]

        point[0]/=weight
        point[1]/=weight
        point[2]/=weight

        point[0] = (ops.nodeCoord(i,1)+fDefX * ops.nodeDisp(i,1)) * weight  # Times the weight
        point[1] = (ops.nodeCoord(i,2)+fDefY * ops.nodeDisp(i,2)) * weight  # Times the weight
        point[2] = (ops.nodeCoord(i,3)+fDefZ * ops.nodeDisp(i,3)) * weight  # Times the weight

        i += 1

# Setting control points for surface
controlPts = compatibility.flip_ctrlpts2d(controlPts)
controlPts = (np.array(controlPts).reshape(
    nPoints, 4))
surf.set_ctrlpts(controlPts.tolist(), surf.ctrlpts_size_u, surf.ctrlpts_size_v)

# Visualize surface
surfVisualize(surf, hold=True)

dispC = ops.nodeDisp(forcedNode)
print("dispC: ", dispC)


print("Done")
